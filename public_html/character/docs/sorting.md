# 並び替え機能

キャラクター図鑑の並び替え機能について説明します。

## 並び替えモードの種類

4つの並び替えモードがあります。

### 1. ID順

キャラクターIDの昇順で表示します。

#### 特徴
- デフォルトの並び順
- 追加された順番で表示されることが多い
- 最も安定した並び順

#### 使用例
- データベースの順番で表示したい
- 追加順を確認したい

### 2. 名前順

キャラクター名のアルファベット順/50音順で表示します。

#### 特徴
- 日本語モード: 50音順（あいうえお順）
- 英語モード: アルファベット順（ABC順）
- 大文字小文字を区別しない

#### ソート詳細
**日本語:**
- ひらがな・カタカナ・漢字を50音順に並べる
- 濁点・半濁点は考慮される

**英語:**
- A-Z順
- 大文字小文字は同一視される

#### 使用例
- 特定のキャラクターを素早く見つけたい
- アルファベット順で一覧したい

### 3. ランダム順

毎回ランダムな順序で表示します。

#### 特徴
- ページを更新するたびに順序が変わる
- 完全ランダム
- 再現性なし

#### 使用例
- 新しい発見をしたい
- ランダムにキャラクターを見たい
- いつもと違う視点で見たい

### 4. カスタム順

ユーザーがドラッグ&ドロップで設定した順序で表示します。

#### 特徴
- 完全に自由な並び順
- ドラッグ&ドロップで設定
- 保存されて次回も同じ順序

#### 使用例
- お気に入りを上位に配置
- グループごとにまとめる
- 重要度順に並べる

詳細は [カスタム並び順の設定](#カスタム並び順の設定) を参照。

## グローバル並び順

全体に適用される並び順です。

### 設定方法
1. ハンバーガーメニューを開く
2. 「並び順: ○○」をクリック
3. 4つのモードが順番に切り替わります

### 切り替えサイクル
ID順 → 名前順 → ランダム順 → カスタム順 → ID順 → ...

### 現在の並び順の確認
ハンバーガーメニューの「並び順: ○○」で確認できます。

### 保存
選択した並び順はlocalStorageに保存され、次回も維持されます。

## タグごとの並び順

カスタムタグごとに個別の並び順を設定できます。

### 設定方法

#### 方法1: カスタムタグ管理画面から
1. ハンバーガーメニューから「カスタムタグ」を開く
2. タグの右側にある並び順ボタンをクリック
3. 4つのモードが順番に切り替わります

#### 方法2: フィルター後に並び替え
1. カスタムタグでフィルター（**1つだけ選択**）
2. 編集モードの「並び替え」サブモードを使用
3. カードをドラッグ&ドロップで並び替え
4. 「並び順を保存」をクリック
5. → そのタグ専用の「カスタム順」として保存される

### 適用ルール
- タグでフィルター中: そのタグ専用の並び順を使用
- タグなし/複数タグ: グローバル並び順を使用

### 例
```
【設定】
- グローバル並び順: ID順
- 「お気に入り」タグの並び順: カスタム順
- 「強キャラ」タグの並び順: 名前順

【表示】
- フィルターなし → ID順
- 「お気に入り」でフィルター → カスタム順
- 「強キャラ」でフィルター → 名前順
- 「お気に入り」+「強キャラ」 → ID順（グローバル）
```

### 保存先
- タグごとの並び順設定: localStorage (`tagSortOrders`)
- タグごとのカスタム順: localStorage (`tagCustomOrders`)

## カスタム並び順の設定

ドラッグ&ドロップで自由に並び順を設定できます。

### 設定手順

#### 1. 編集モードを起動
1. ハンバーガーメニューを開く
2. 「編集モード: オン」をクリック

#### 2. 並び替えサブモードに切り替え
1. 編集ツールバーの「並び替え」ボタンをクリック

#### 3. カードを並び替え
**PCの場合:**
1. カードをクリックしてドラッグ
2. 目的の位置まで移動
3. ドロップして配置

**モバイルの場合:**
1. カードを長押し
2. 目的の位置までドラッグ
3. 指を離して配置

#### 4. 保存
1. 「並び順を保存」ボタンをクリック
2. 現在の並び順が保存されます

### 保存範囲の決定

#### グローバル保存
フィルターなし、または基本フィルター（世界、種族など）のみの場合:
- 全体のカスタム並び順として保存
- 並び順モードが自動的に「カスタム」に切り替わる

#### タグ専用保存
カスタムタグフィルターを**1つだけ**適用している場合:
- そのタグ専用のカスタム並び順として保存
- そのタグの並び順モードが自動的に「カスタム」に切り替わる

#### 注意
複数のカスタムタグでフィルター中は、グローバル保存になります。

### 視覚効果
- ドラッグ中: カードが半透明に
- ドラッグ中: カードが少し縮小
- 配置可能位置: 視覚的に表示

### リサイズ対応
並び替えモード中にウィンドウサイズを変更しても、編集中の並び順は保持されます。

## 並び替えの実装詳細

### ソートアルゴリズム

#### ID順
```javascript
characters.sort((a, b) => a.id - b.id)
```

#### 名前順（日本語）
```javascript
characters.sort((a, b) => a.name.ja.localeCompare(b.name.ja, 'ja'))
```

#### 名前順（英語）
```javascript
characters.sort((a, b) => a.name.en.localeCompare(b.name.en, 'en'))
```

#### ランダム順
```javascript
characters.sort(() => Math.random() - 0.5)
```

#### カスタム順
保存された順序配列に基づいてソート
```javascript
const orderMap = new Map(customOrder.map((id, index) => [id, index]))
characters.sort((a, b) => {
  const indexA = orderMap.get(a.id) ?? Infinity
  const indexB = orderMap.get(b.id) ?? Infinity
  return indexA - indexB
})
```

### パフォーマンス最適化
- ソート処理はメモリ上で実行
- 大量データでも高速
- フィルター適用後にソート（効率的）

## 保存されるデータ

### localStorage

#### グローバル並び順
```javascript
// キー: 'sortOrder'
// 値: 'id' | 'name' | 'random' | 'custom'
```

#### グローバルカスタム順
```javascript
// キー: 'customCharacterOrder'
// 値: [charId1, charId2, charId3, ...]
```

#### タグごとの並び順設定
```javascript
// キー: 'tagSortOrders'
// 値: {
//   "tagId1": "id",
//   "tagId2": "custom",
//   "tagId3": "name"
// }
```

#### タグごとのカスタム順
```javascript
// キー: 'tagCustomOrders'
// 値: {
//   "tagId1": [charId1, charId2, ...],
//   "tagId2": [charId5, charId3, ...]
// }
```

## ベストプラクティス

### 並び順の選択

#### ID順を使う場面
- デフォルトの状態で見たい
- 追加順を確認したい
- 安定した順序が必要

#### 名前順を使う場面
- 特定のキャラクターを探したい
- アルファベット順で見たい
- 辞書的な順序が必要

#### ランダム順を使う場面
- 新しい発見をしたい
- マンネリを防ぎたい
- ランダムな順序が必要

#### カスタム順を使う場面
- 自分好みの順序にしたい
- グループごとにまとめたい
- 重要度で並べたい

### カスタム順の設定コツ

#### 階層的な配置
1. 最重要キャラ（上部）
2. 重要キャラ
3. 通常キャラ
4. その他（下部）

#### グループ化
関連するキャラクターを近くに配置:
- 同じ作品のキャラ
- 同じチームのキャラ
- 同じ種族のキャラ

#### 視覚的な整理
- 強さ順
- レアリティ順
- 使用頻度順

### タグごとの並び順活用

#### 例1: 育成状況別
- 「育成完了」タグ: 名前順（探しやすい）
- 「育成中」タグ: カスタム順（優先度順）
- 「未育成」タグ: ID順（デフォルト）

#### 例2: 用途別
- 「PvP用」タグ: カスタム順（強さ順）
- 「PvE用」タグ: カスタム順（役割順）
- 「探索用」タグ: 名前順（管理しやすい）

#### 例3: お気に入り管理
- 「★★★」タグ: カスタム順（大好きな順）
- 「★★」タグ: 名前順（探しやすい）
- 「★」タグ: ID順（シンプルに）

## トラブルシューティング

### 並び順が変わらない
1. 並び順モードを確認
2. ページをリロード
3. キャッシュをクリア

### カスタム順が保存されない
1. localStorageが有効か確認
2. プライベートモードでないか確認
3. ストレージ容量を確認
4. 「並び順を保存」ボタンを押したか確認

### タグごとの並び順が適用されない
1. タグを1つだけ選択しているか確認
2. そのタグの並び順設定を確認
3. グローバル並び順と混同していないか確認

### 並び替え中にリセットされる
1. 編集モードを終了していないか確認
2. フィルターを変更していないか確認
3. v2.0以降にアップデート済みか確認

### ドラッグできない
1. 「並び替え」サブモードが選択されているか確認
2. 編集モードがオンになっているか確認
3. ブラウザがドラッグ&ドロップに対応しているか確認

### モバイルでドラッグできない
1. 長押ししてからドラッグ
2. ブラウザのタッチイベントが有効か確認
3. 画面サイズが十分か確認

## 詳細ドキュメント

より詳しい情報は以下を参照してください:
- [編集モード](./edit-mode.md#並び替えモード) - 並び替えモードの詳細
- [カスタムタグ](./custom-tags.md#タグごとの並び順) - タグごとの並び順
- [技術仕様](./technical-specs.md) - 実装の詳細
