# カスタムタグ

カスタムタグ機能では、ユーザー独自のタグを作成してキャラクターを分類できます。

## カスタムタグ管理画面

### 開き方
1. ハンバーガーメニュー（☰）を開く
2. 「カスタムタグ」をクリック
3. カスタムタグ管理ポップアップが表示されます

### 閉じ方
- ×ボタンをクリック
- Escキーを押す
- ポップアップ外をクリック

## タグの作成

### 手順
1. カスタムタグ管理画面を開く
2. 「新しいタグを作成」セクションを探す
3. タグ名を入力
4. 色を選択
5. 「作成」ボタンをクリック

### タグ名の入力
- **文字数**: 1文字以上20文字以下推奨
- **使用可能文字**: すべての文字（絵文字も可）
- **重複**: 同じ名前のタグも作成可能（推奨しない）

**例:**
- お気に入り
- 主要キャラ
- 強キャラ
- ネタキャラ
- 😊 推し

### 色の選択

#### プリセットカラー
よく使う色があらかじめ用意されています:
- 赤系
- 青系
- 緑系
- 黄系
- 紫系
- ピンク系
- グレー系

#### カスタムカラー
1. 「カスタム色」ボタンをクリック
2. カラーピッカーが開きます
3. 任意の色を選択
4. 選択した色が適用されます

### 作成の確認
タグが作成されると、タグ一覧に追加されます。

## タグの管理

### タグ一覧

作成済みのタグが一覧表示されます。

#### 表示情報
- タグ名
- タグの色（背景色）
- 使用数（タグが付いているキャラクター数）
- 並び順（自由に変更可能）

### タグの編集

#### 名前の変更
1. タグの「編集」ボタンをクリック
2. 新しい名前を入力
3. 「保存」をクリック

#### 色の変更
1. タグの「編集」ボタンをクリック
2. 新しい色を選択
3. 「保存」をクリック

### タグの削除

#### 削除手順
1. タグの「削除」ボタンをクリック
2. 確認ダイアログが表示されます
3. 「削除」をクリックで確定

#### 削除時の注意
- タグを削除すると、全てのキャラクターから削除されます
- 削除は元に戻せません
- 削除前にエクスポートしておくことを推奨

### タグの並び替え

#### ドラッグ&ドロップで並び替え

**PCの場合:**
1. タグの左側のドラッグハンドル（≡）をドラッグ
2. 目的の位置まで移動
3. ドロップして配置

**モバイルの場合:**
1. タグを長押し
2. 目的の位置までドラッグ
3. 指を離して配置

#### 並び順の保存
並び順は自動的にIndexedDBに保存されます。

## タグの使用

### キャラクターにタグを追加

#### 個別追加（詳細画面から）
1. キャラクターカードをクリック
2. 詳細画面が開きます
3. 「カスタムタグ」セクションを探す
4. 「+」ボタンまたは「タグを追加」をクリック
5. タグを選択
6. 自動的に保存されます

#### 一括追加（編集モードから）
1. 編集モードを有効化
2. 「選択」サブモードを選択
3. 複数のキャラクターを選択
4. 「一括タグ追加」ボタンをクリック
5. タグを選択
6. 「適用」をクリック

詳細は [編集モード](./edit-mode.md#一括タグ追加) を参照。

### タグの削除

#### 個別削除
1. キャラクターの詳細画面を開く
2. タグの×ボタンをクリック
3. 自動的に削除されます

#### 一括削除
1. 編集モードの「選択」サブモードを使用
2. キャラクターを選択
3. 「一括タグ追加」から削除したいタグのチェックを外す
4. 「適用」をクリック

## タグでフィルター

### フィルター方法
1. フィルターボタンをクリック
2. 「カスタムタグ」セクションを探す
3. タグを選択（複数選択可能）
4. 「適用」をクリック

### OR条件
複数のタグを選択すると、**いずれかのタグ**を持つキャラクターが表示されます。

**例:**
- 「お気に入り」OR「主要キャラ」を選択
- → どちらかのタグを持つキャラクターが表示される

### AND条件（他のフィルターと組み合わせ）
カスタムタグと他のフィルター（世界、種族など）を組み合わせると、AND条件になります。

**例:**
- カスタムタグ: 「お気に入り」
- 世界: 「ファンタジー世界」
- → 「お気に入り」タグを持ち、かつ「ファンタジー世界」のキャラクター

## タグごとの並び順

カスタムタグでフィルターした時の並び順を個別に設定できます。

### 設定方法
1. カスタムタグでフィルター（1つだけ選択）
2. 編集モードの「並び替え」サブモードを使用
3. カードをドラッグ&ドロップで並び替え
4. 「並び順を保存」をクリック

### 並び順の切り替え
カスタムタグ管理画面で、各タグの並び順を切り替えできます:
- ID順
- 名前順
- ランダム順
- カスタム順（ドラッグ&ドロップで設定したもの）

詳細は [並び替え機能](./sorting.md#タグごとの並び順) を参照。

## タグの検索

### 設定
ハンバーガーメニューから「カスタムタグ検索: 有効/無効」で切り替え。

### 使い方
有効にすると、検索バーでタグ名を入力してキャラクターを検索できます。

**例:**
- 検索: "お気に入り"
- → 「お気に入り」タグを持つキャラクターが検索結果に表示

## データのエクスポート/インポート

### エクスポート
1. ハンバーガーメニューから「データ管理」を開く
2. 「カスタムタグをエクスポート」をクリック
3. JSONファイルがダウンロードされます

### インポート
1. 「データ管理」を開く
2. 「カスタムタグをインポート」をクリック
3. JSONファイルを選択
4. データが復元されます

詳細は [データ管理](./data-management.md) を参照。

## 保存先

カスタムタグデータは以下に保存されます:
- **タグ情報**: IndexedDB (`CustomTagsDB`)
- **タグの並び順**: IndexedDB
- **キャラクターとタグの紐付け**: IndexedDB (`CharactersDB`)

## ベストプラクティス

### タグの命名
- **明確な名前**: 何のタグか一目でわかる名前をつける
- **一貫性**: 命名規則を統一する
- **短く**: 長すぎる名前は避ける

**良い例:**
- お気に入り
- 主要キャラ
- 強キャラ

**避けるべき例:**
- タグ1
- あああ
- これは非常に重要なキャラクターのタグです

### 色の使い分け
- **用途別**: 目的ごとに色を分ける
- **視認性**: 見やすい色を選ぶ
- **統一感**: 関連するタグは似た色にする

**例:**
- 重要度: 赤 > 黄 > 青
- 所属: チームAは赤系、チームBは青系
- 状態: 使用中=緑、未使用=グレー

### タグの整理
- **定期的な見直し**: 使わないタグは削除
- **統合**: 似たようなタグはまとめる
- **階層化**: 大分類→小分類の命名規則を使う

**例:**
- 重要_主人公
- 重要_仲間
- サブ_村人

### バックアップ
- **定期的なエクスポート**: 月1回程度
- **複数保存**: 日付付きで複数保存
- **クラウド保存**: Googleドライブなどに保管

## トラブルシューティング

### タグが作成できない
1. タグ名が入力されているか確認
2. 色が選択されているか確認
3. ブラウザのIndexedDBが有効か確認

### タグが保存されない
1. プライベートモードでないか確認
2. ブラウザのストレージ容量を確認
3. IndexedDBのデータを確認

### タグが消えた
1. ブラウザのデータを削除していないか確認
2. バックアップからインポート
3. IndexedDBを確認

### タグの色が変わらない
1. ブラウザのキャッシュをクリア
2. ページをリロード
3. 保存ボタンを押したか確認

### ドラッグで並び替えができない
1. ドラッグハンドル（≡）をドラッグしているか確認
2. ブラウザがドラッグ&ドロップに対応しているか確認
3. JavaScriptエラーがないか確認

## 活用例

### 使用例1: プレイスタイル別の分類
- **タグ**: 物理型、魔法型、バランス型
- **用途**: 編成を考える時に便利

### 使用例2: 育成状況の管理
- **タグ**: 育成完了、育成中、未育成
- **用途**: 育成の進捗管理

### 使用例3: お気に入り管理
- **タグ**: ★★★、★★、★
- **用途**: 好きなキャラクターのランク付け

### 使用例4: イベント用
- **タグ**: イベント2024冬、イベント2024春
- **用途**: イベント別の参加キャラクター管理

### 使用例5: コンテンツ別
- **タグ**: PvP用、PvE用、探索用
- **用途**: 用途別のキャラクター分類
