<!DOCTYPE html>
<html lang="ja">
 <html>
  <head>
   <meta charset="utf-8">
   <title>ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³RPG</title>
   <link rel="icon" href="https://minntogames.github.io/image/icon.ico">
	 </head>
	 <body style="background-color:aquamarine;">
<script type="text/javascript">
/*
	ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³RPG

	2010-07-03ï½2010-12-19 å‰µä½œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¡—

	ã‚²ãƒ¼ãƒ ç”»é¢è¡¨ç¤ºç”¨ã®HTMLã‚¿ã‚°ã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆè¨­å®šãªã©ã™ã¹ã¦ã‚³ãƒ¼ãƒ‰ã«å«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€scriptã‚¿ã‚°ã§è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§å®Ÿè¡Œã§ãã¾ã™
*/

// ã‚²ãƒ¼ãƒ ç®¡ç†ã‚¯ãƒ©ã‚¹
var fjsRDunjonWorldTemplate = function() {

	var i;

	// ç¾åœ¨ã®éšå±¤
	this.level = 0;

	// ç¾åœ¨éšãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿
	this.map = new Array();

	// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿æƒ…å ±é…åˆ—ä½œæˆ
	this.charList = new Array();

	// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ï¼ˆä¸»äººå…¬ã¨æ•µï¼‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
	this.charTable = new Array();

	// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
	for (i = 0;i < 11;i++) {
		this.charTable.push(new fjsRDunjonChr());
	}

	// ä¸»äººå…¬ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆæœŸå€¤
	this.START_MHP = 99;
	this.START_STR = 99;
	this.START_TOUGH = 99;

	// ä¸»äººå…¬åˆæœŸãƒ‡ãƒ¼ã‚¿
	this.charTable[0].type = 1;
	this.charTable[0].chr = 'ğŸ˜ƒ';
	this.charTable[0].name = "ä¸»äººå…¬";
	this.charTable[0].hp = this.START_MHP;
	this.charTable[0].mhp = this.START_MHP;
	this.charTable[0].str = this.START_STR;
	this.charTable[0].tough = this.START_TOUGH;
	this.charTable[0].at = 0;
	this.charTable[0].def = 0;
	this.charTable[0].exp = 0;
	this.charTable[0].mexp = 0;
	this.charTable[0].actionPoint = 0;
	this.charTable[0].actionCharge = 4;
	this.charTable[0].actionAttack = 0;
	this.charTable[0].actionFollow = 0;
	this.charTable[0].actionMove = 0;

	// ã‚¹ãƒ©ã‚¤ãƒ 
	this.charTable[1].type = 2;
	this.charTable[1].chr = 'ï½“';
	this.charTable[1].name = "ã‚¹ãƒ©ã‚¤ãƒ ";
	this.charTable[1].hp = 10;
	this.charTable[1].mhp = 10;
	this.charTable[1].str = 3;
	this.charTable[1].at = 3;
	this.charTable[1].tough = 4;
	this.charTable[1].def = 4;
	this.charTable[1].exp = 0;
	this.charTable[1].mexp = 8;
	this.charTable[1].actionPoint = 0;
	this.charTable[1].actionCharge = 5;
	this.charTable[1].actionAttack = 50;
	this.charTable[1].actionFollow = 10;
	this.charTable[1].actionMove = 60;

	// ã‚³ã‚¦ãƒ¢ãƒª
	this.charTable[2].type = 3;
	this.charTable[2].chr = 'ï½‚';
	this.charTable[2].name = "ã‚³ã‚¦ãƒ¢ãƒª";
	this.charTable[2].hp = 12;
	this.charTable[2].mhp = 12;
	this.charTable[2].str = 5;
	this.charTable[2].tough = 8;
	this.charTable[2].at = 5;
	this.charTable[2].def = 8;
	this.charTable[2].exp = 0;
	this.charTable[2].mexp = 16;
	this.charTable[2].actionPoint = 0;
	this.charTable[2].actionCharge = 4;
	this.charTable[2].actionAttack = 80;
	this.charTable[2].actionFollow = 80;
	this.charTable[2].actionMove = 60;

	// ãƒŸãƒŸã‚º
	this.charTable[3].type = 4;
	this.charTable[3].chr = 'ï½';
	this.charTable[3].name = "ãƒŸãƒŸã‚º";
	this.charTable[3].hp = 20;
	this.charTable[3].mhp = 20;
	this.charTable[3].str = 10;
	this.charTable[3].tough = 7;
	this.charTable[3].at = 10;
	this.charTable[3].def = 7;
	this.charTable[3].exp = 0;
	this.charTable[3].mexp = 25;
	this.charTable[3].actionPoint = 0;
	this.charTable[3].actionCharge = 5;
	this.charTable[3].actionAttack = 60;
	this.charTable[3].actionFollow = 30;
	this.charTable[3].actionMove = 50;

	// å¤§ãƒˆã‚«ã‚²
	this.charTable[4].type = 5;
	this.charTable[4].chr = 'ï½’';
	this.charTable[4].name = "å¤§ãƒˆã‚«ã‚²";
	this.charTable[4].hp = 25;
	this.charTable[4].mhp = 25;
	this.charTable[4].str = 14;
	this.charTable[4].tough = 15;
	this.charTable[4].at = 14;
	this.charTable[4].def = 15;
	this.charTable[4].exp = 0;
	this.charTable[4].mexp = 35;
	this.charTable[4].actionPoint = 0;
	this.charTable[4].actionCharge = 5;
	this.charTable[4].actionAttack = 70;
	this.charTable[4].actionFollow = 40;
	this.charTable[4].actionMove = 30;

	// ã‚ªã‚ªã‚«ãƒŸ
	this.charTable[5].type = 6;
	this.charTable[5].chr = 'ï½—';
	this.charTable[5].name = "ã‚ªã‚ªã‚«ãƒŸ";
	this.charTable[5].hp = 32;
	this.charTable[5].mhp = 32;
	this.charTable[5].str = 18;
	this.charTable[5].tough = 20;
	this.charTable[5].at = 18;
	this.charTable[5].def = 20;
	this.charTable[5].exp = 0;
	this.charTable[5].mexp = 50;
	this.charTable[5].actionPoint = 0;
	this.charTable[5].actionCharge = 4;
	this.charTable[5].actionAttack = 90;
	this.charTable[5].actionFollow = 80;
	this.charTable[5].actionMove = 40;

	// ã‚ªãƒ¼ã‚¯
	this.charTable[6].type = 7;
	this.charTable[6].chr = 'ï¼¯';
	this.charTable[6].name = "ã‚ªãƒ¼ã‚¯";
	this.charTable[6].hp = 42;
	this.charTable[6].mhp = 42;
	this.charTable[6].str = 22;
	this.charTable[6].tough = 22;
	this.charTable[6].at = 22;
	this.charTable[6].def = 22;
	this.charTable[6].exp = 0;
	this.charTable[6].mexp = 65;
	this.charTable[6].actionPoint = 0;
	this.charTable[6].actionCharge = 4;
	this.charTable[6].actionAttack = 80;
	this.charTable[6].actionFollow = 70;
	this.charTable[6].actionMove = 50;

	// ã‚°ãƒ¼ãƒ«
	this.charTable[7].type = 8;
	this.charTable[7].chr = 'ï¼§';
	this.charTable[7].name = "ã‚°ãƒ¼ãƒ«";
	this.charTable[7].hp = 52;
	this.charTable[7].mhp = 52;
	this.charTable[7].str = 26;
	this.charTable[7].tough = 20;
	this.charTable[7].at = 26;
	this.charTable[7].def = 20;
	this.charTable[7].exp = 0;
	this.charTable[7].mexp = 85;
	this.charTable[7].actionPoint = 0;
	this.charTable[7].actionCharge = 4;
	this.charTable[7].actionAttack = 80;
	this.charTable[7].actionFollow = 80;
	this.charTable[7].actionMove = 40;

	// æ´çªŸç†Š
	this.charTable[8].type = 9;
	this.charTable[8].chr = 'B';
	this.charTable[8].name = "æ´çªŸç†Š";
	this.charTable[8].hp = 65;
	this.charTable[8].mhp = 65;
	this.charTable[8].str = 36;
	this.charTable[8].tough = 30;
	this.charTable[8].at = 36;
	this.charTable[8].def = 30;
	this.charTable[8].exp = 0;
	this.charTable[8].mexp = 120;
	this.charTable[8].actionPoint = 0;
	this.charTable[8].actionCharge = 5;
	this.charTable[8].actionAttack = 70;
	this.charTable[8].actionFollow = 50;
	this.charTable[8].actionMove = 40;

	// ãƒˆãƒ©
	this.charTable[9].type = 10;
	this.charTable[9].chr = 'ï¼´';
	this.charTable[9].name = "ãƒˆãƒ©";
	this.charTable[9].hp = 87;
	this.charTable[9].mhp = 87;
	this.charTable[9].str = 50;
	this.charTable[9].tough = 45;
	this.charTable[9].at = 50;
	this.charTable[9].def = 45;
	this.charTable[9].exp = 0;
	this.charTable[9].mexp = 160;
	this.charTable[9].actionPoint = 0;
	this.charTable[9].actionCharge = 3;
	this.charTable[9].actionAttack = 80;
	this.charTable[9].actionFollow = 50;
	this.charTable[9].actionMove = 70;

	// ãƒ‰ãƒ©ã‚´ãƒ³
	this.charTable[10].type = 11;
	this.charTable[10].chr = 'ï¼¤';
	this.charTable[10].name = "ç´…ç«œ";
	this.charTable[10].hp = 180;
	this.charTable[10].mhp = 180;
	this.charTable[10].str = 120;
	this.charTable[10].tough = 120;
	this.charTable[10].at = 120;
	this.charTable[10].def = 120;
	this.charTable[10].exp = 0;
	this.charTable[10].mexp = 255;
	this.charTable[10].actionPoint = 0;
	this.charTable[10].actionCharge = 4;
	this.charTable[10].actionAttack = 100;
	this.charTable[10].actionFollow = 0;
	this.charTable[10].actionMove = 0;

	// ãƒãƒƒãƒ—ã‚µã‚¤ã‚ºè¨­å®š
	this.MAP_COLS = 15;
	this.MAP_ROWS = 15;

	// ç©´ã®ä½ç½®è¨­å®š
	this.MAP_HOLE_X = Math.floor(this.MAP_COLS / 2);
	this.MAP_HOLE_Y = Math.floor(this.MAP_ROWS / 2);

	// ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®è¨­å®š
	this.START_X = Math.floor(this.MAP_COLS / 2);
	this.START_Y = Math.floor(this.MAP_ROWS / 2) + 2;

	// å‡¦ç†ã‚«ã‚¦ãƒ³ã‚¿
	this.levelTick = 0;

	// æ•µå‡ºç¾ã‚«ã‚¦ãƒ³ã‚¿
	this.enemyPop = 50;

	// ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
	this.reset = function() {

		var i;

		// ãƒãƒƒãƒ—é…åˆ—åˆæœŸåŒ–
		for (i = 0;i < this.MAP_ROWS;i++) {
			this.map[i] = new Array();
		}

		// ä¸»äººå…¬ä½œæˆ
		this.charList[0] = new fjsRDunjonChr();
		this.charList[0].assign(this.charTable[0]);

		this.charList[0].mhp = fjsRDunjonWorld.START_MHP + Math.floor(Math.sqrt(fjsRDunjonWorld.charList[0].exp * 3));
		this.charList[0].str = fjsRDunjonWorld.START_STR + Math.floor(Math.sqrt(fjsRDunjonWorld.charList[0].exp * 1.8));
		this.charList[0].tough = fjsRDunjonWorld.START_TOUGH + Math.floor(Math.sqrt(fjsRDunjonWorld.charList[0].exp * 1.8));

		this.enemyPop = 50;
		this.levelTick = 0;

		this.charList[0].updateStatus();

	}

	// ã‚²ãƒ¼ãƒ ä¸­ã®æ›´æ–°å‡¦ç†
	this.levelProcess = function() {

		// 15ã‚«ã‚¦ãƒ³ãƒˆæ¯ã«HPå›å¾©
		if ((this.levelTick % 15) == 14 && this.charList[0].hp < this.charList[0].mhp) {

			// ä¸»äººå…¬ã®æœ€å¤§HPã«å¿œã˜ã¦å›å¾©é‡ã‚’æ±ºå®š
			this.charList[0].hp += 1 + Math.floor(this.charList[0].mhp / 30);

			// å›å¾©ã®çµæœä¸»äººå…¬ã®HPãŒæœ€å¤§HPã‚’è¶…ãˆã¦ã„ãŸã‚‰HPã‚’æœ€å¤§HPã«
			if (this.charList[0].hp > this.charList[0].mhp) {
				this.charList[0].hp = this.charList[0].mhp;
			}

		}

		// æ•µãŒ8åŒ¹ä»¥ä¸‹ãªã‚‰ä¸€å®šæœŸé–“æ¯ã«æ•µå‡ºç¾
		if ((this.levelTick % this.enemyPop) == 0 && this.charList.length < 8) {

			// æ•µã®ä½ç½®ã‚’ä¹±æ•°ã§æ±ºå®š
			x = 1 + Math.floor(Math.random() * this.MAP_COLS - 2);
			y = 1 + Math.floor(Math.random() * this.MAP_ROWS - 2);

			// é…ç½®å¯èƒ½ãªä½ç½®ãªã‚‰æ•µã‚’é…ç½®
			if (this.canMove(x, y) && (x != this.MAP_HOLE_X && y != this.MAP_HOLE_Y)) {

				// æ•µã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
				var obj = new fjsRDunjonChr();

				// ç¾åœ¨ã®éšå±¤ã«å¿œã˜ã¦æ•µã®ç¨®é¡ã‚’æ±ºå®šã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
				obj.assign(this.charTable[this.level + 1 + Math.floor(Math.random() * 2)]);
				obj.x = x;
				obj.y = y;

				// ç”Ÿæˆã—ãŸæ•µã‚’ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒªã‚¹ãƒˆã«è¿½åŠ 
				this.charList.push(obj);

			}

		}

		this.levelTick++;

	}

	// æŒ‡å®šä½ç½®ãŒç©´ã‹åˆ¤å®š
	this.isHole = function(x, y) {

		if (x < 0 || x >= this.MAP_COLS || y < 0 || y >= this.MAP_ROWS) {
			return false;
		}

		if (this.map[x][y] == 1) {
			return true;
		}

		return false;

	}

	// æŒ‡å®šä½ç½®ã«é€²å…¥å¯èƒ½ã‹åˆ¤å®š
	this.canMove = function(x, y) {

		var i;

		if (x < 0 || x >= this.MAP_COLS || y < 0 || y >= this.MAP_ROWS) {
			return false;
		}

		if (this.map[x][y] != 0) {
			return false;
		}

		for (i = 0;i < this.charList.length;i++) {
			if (this.charList[i].hp > 0 && x == this.charList[i].x && y == this.charList[i].y) {
				return false;
			}
		}

		return true;

	}

	this.nextLevel = function() {
		this.newLevel(this.level + 1);
	}

	// éšã®ç§»å‹•å‡¦ç†ï¼ˆãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä½œæˆã¨æ•µã®åˆæœŸé…ç½®ï¼‰
	this.newLevel = function(level) {

		var i;
		var j;
		var elm;

		// ãƒãƒƒãƒ—ãƒ‘ãƒ¼ãƒ„é…ç½®
		for (i = 0;i < this.MAP_ROWS;i++) {
			for (j = 0;j < this.MAP_COLS;j++) {
				if (i == 0 || i == this.MAP_ROWS - 1 || j == 0 || j == this.MAP_COLS - 1) {
					this.map[j][i] = 4;
				} else {
					if (level != 7 && i == this.MAP_HOLE_Y && j == this.MAP_HOLE_X) {
						this.map[j][i] = 1;
					} else {
						this.map[j][i] = 0;
					}
				}
			}
		}

		// ç©´ã®å‘¨ã‚Šã«å£ã‚’é…ç½®
		if (level != 7) {

			for (i = this.MAP_HOLE_Y - 1;i < this.MAP_HOLE_Y + 2;i++) {
				for (j = this.MAP_HOLE_X - 1;j < this.MAP_HOLE_X + 2;j++) {
					if (j != this.MAP_HOLE_X || i == this.MAP_HOLE_Y + 1) {
						this.map[j][i] = 4;
					}
				}
			}

		}

		// ã‚²ãƒ¼ãƒ ç”»é¢ã®å„è¦ç´ ã‚’è¡¨ç¤º
		for (i = 0;i < fjsRDunjonWorld.MAP_ROWS;i++) {
			for (j = 0;j < fjsRDunjonWorld.MAP_COLS;j++) {

				elm = document.getElementById('fjsRDunjonCell' + Number(j).toString(16) + Number(i).toString(16));

				// ãƒãƒƒãƒ—è¦ç´ æç”»
				switch (fjsRDunjonWorld.map[j][i]) {

				case 0:

					elm.style.background = fjsRDunjonCellBG;

					break;

				case 2:

					elm.style.background = '#000000';

					break;

				case 4:

					elm.style.background = '#e0e0ff';

					break;

				}

				elm.innerHTML = '';

			}
		}

		// éšæ•°è¡¨ç¤º
		elm = document.getElementById('fjsRDunjonLevelLabel');
		elm.innerHTML = 'åœ°ä¸‹' + (level + 1) + 'éš';

		this.charList[1] = new fjsRDunjonChr();
		this.charList[1].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[1].x = 1;
		this.charList[1].y = Math.floor(this.MAP_ROWS / 2);

		this.charList[2] = new fjsRDunjonChr();
		this.charList[2].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[2].x = this.MAP_COLS - 2;
		this.charList[2].y = Math.floor(this.MAP_ROWS / 2);

		this.charList[3] = new fjsRDunjonChr();
		this.charList[3].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[3].x = Math.floor(this.MAP_COLS / 2);
		this.charList[3].y = 1;

		this.charList[4] = new fjsRDunjonChr();
		this.charList[4].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[4].x = Math.floor(this.MAP_COLS / 2);
		this.charList[4].y = this.MAP_ROWS - 2;

		this.charList[5] = new fjsRDunjonChr();
		this.charList[5].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[5].x = 1;
		this.charList[5].y = 1;

		this.charList[6] = new fjsRDunjonChr();
		this.charList[6].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[6].x = this.MAP_COLS - 2;
		this.charList[6].y = 1;

		this.charList[7] = new fjsRDunjonChr();
		this.charList[7].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[7].x = this.MAP_COLS - 2;
		this.charList[7].y = this.MAP_ROWS - 2;

		this.charList[8] = new fjsRDunjonChr();
		this.charList[8].assign(this.charTable[level + 1 + Math.floor(Math.random() * 2)]);
		this.charList[8].x = 1;
		this.charList[8].y = this.MAP_ROWS - 2;

		// åœ°ä¸‹8éšãªã‚‰ãƒ‰ãƒ©ã‚´ãƒ³è¿½åŠ 
		if (level == 7) {

			this.charList[9] = new fjsRDunjonChr();
			this.charList[9].assign(this.charTable[10]);
			this.charList[9].x = this.MAP_HOLE_X;
			this.charList[9].y = this.MAP_HOLE_Y;

			// æ•µã®æ¹§å‡ºå‘¨æœŸã‚’äºŒå€ã«
			this.enemyPop = 100;

		}

		// ä¸»äººå…¬ã®åˆæœŸä½ç½®è¨­å®š
		this.charList[0].x = this.START_X;
		this.charList[0].y = this.START_Y;

		this.level = level;
		this.levelTick = 0;

	}

	// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿é–“ã®è·é›¢ã‚’å–å¾—
	this.distance = function(chr1, chr2) {

		return Math.abs(chr1.x - chr2.x) + Math.abs(chr1.y - chr2.y);

	}

	// æ”»æ’ƒå‡¦ç†
	this.attack = function(atk, def) {

		// ãƒ€ãƒ¡ãƒ¼ã‚¸åŸºæœ¬å€¤è¨ˆç®—
		var dmg = Math.floor(Math.sqrt(atk.at * (atk.at / def.def)));

		// ãƒ€ãƒ¡ãƒ¼ã‚¸ã«ä¹±æ•°ã‚’åŠ ãˆã‚‹
		dmg += Math.floor(Math.random() * Math.sqrt(atk.hp / 4));

		if (dmg < 1) {
			return;
		}

		def.attacked(dmg);

		// æ”»æ’ƒå¯¾è±¡ãŒæ­»äº¡
		if (def.hp <= 0) {

			// ä¸»äººå…¬
			if (def == this.charList[0]) {

				fjsRDunjonState = fjsRDunjonSTATE_OVER;

				fjsGameMessage = "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼";

			} else {

				atk.exp += def.mexp;

				if (atk.exp > 9999) {
					atk.exp = 9999;
				}

				// çµŒé¨“å€¤ã«å¿œã˜ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨­å®š
				this.charList[0].mhp = fjsRDunjonWorld.START_MHP + Math.floor(Math.sqrt(fjsRDunjonWorld.charList[0].exp * 3));
				this.charList[0].str = fjsRDunjonWorld.START_STR + Math.floor(Math.sqrt(fjsRDunjonWorld.charList[0].exp * 1.8));
				this.charList[0].tough = fjsRDunjonWorld.START_STR + Math.floor(Math.sqrt(fjsRDunjonWorld.charList[0].exp * 1.8));

				this.charList[0].updateStatus();

				// ãƒ‰ãƒ©ã‚´ãƒ³ã‚’å€’ã—ãŸã‚‰ã‚¯ãƒªã‚¢
				if (def.type == 11) {

					fjsRDunjonState = fjsRDunjonSTATE_CLEAR;

					fjsGameMessage = "ã‚¯ãƒªã‚¢";

				}

				// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿é…åˆ—å†…å€’ã—ãŸæ•µã®ä½ç½®ã«æœ€å¾Œå°¾ã®æ•µã‚’ã‚³ãƒ”ãƒ¼
				for (i = 1;i < this.charList.length - 1;i++) {
					if (this.charList[i] == def) {

						this.charList[i] = this.charList[this.charList.length - 1];

						break;

					}
				}

				// å€’ã—ãŸæ•µã‚’å‰Šé™¤
				delete def;

				// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿é…åˆ—ã®æœ€å¾Œå°¾ã‚’å‰Šé™¤
				this.charList.pop();

			}

		}

	}

}

// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ã‚¯ãƒ©ã‚¹
var fjsRDunjonChr = function() {

	this.type = 0;
	this.chr = '';

	this.x = 0;
	this.y = 0;

	this.hp = 0;

	this.mhp = 0;
	this.str = 0;
	this.def = 0;

	this.damage = 0;

	// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
	this.assign = function(arg) {

		this.type = arg.type;
		this.chr = arg.chr;
		this.name = arg.name;

		this.x = arg.x;
		this.y = arg.y;

		this.hp = arg.hp;
		this.mhp = arg.mhp;
		this.str = arg.str;
		this.tough = arg.tough;
		this.at = arg.at;
		this.def = arg.def;
		this.exp = arg.exp;
		this.mexp = arg.mexp;

		this.damage = arg.damage;

		this.actionPoint = arg.actionPoint;
		this.actionCharge = arg.actionCharge;

		this.actionAttack = arg.actionAttack;
		this.actionFollow = arg.actionFollow;
		this.actionMove = arg.actionMove;

	}

	this.updateStatus = function() {

		this.at = this.str;
		this.def = this.tough;

	}

	// æ”»æ’ƒã•ã‚ŒãŸã¨ãã®å‡¦ç†
	this.attacked = function(dmg) {

		this.hp -= dmg;

		if (this.hp < 0) {
			this.hp = 0;
		}

		// ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ•ãƒ©ã‚°è¨­å®š
		this.damage = dmg;

	}

	// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ï¼ˆæ•µï¼‰ã®è¡Œå‹•å‡¦ç†
	this.action = function() {

		// è¡Œå‹•å¯èƒ½ã‚«ã‚¦ãƒ³ã‚¿ãŒ0ã§ãªã‘ã‚Œã°è¡Œå‹•ã—ãªã„
		if (this.actionPoint > 0) {
			return;
		}

		var ex = this.x;
		var ey = this.y;

		// è¡Œå‹•å¯èƒ½ã‚«ã‚¦ãƒ³ã‚¿ã‚’å†è¨­å®š
		this.actionPoint = this.actionCharge;

		// ä¸»äººå…¬ã«éš£æ¥ã—ã¦ã„ãŸã‚‰è¡Œå‹•ç¢ºç‡ã«å¿œã˜ã¦æ”»æ’ƒ
		if (fjsRDunjonWorld.distance(this, fjsRDunjonWorld.charList[0]) == 1 && (Math.random() * 100) < this.actionAttack) {

			fjsRDunjonWorld.attack(this, fjsRDunjonWorld.charList[0]);

			return;

		}

		// è¿½è·¡
		if (fjsRDunjonWorld.distance(this, fjsRDunjonWorld.charList[0]) > 1 && (Math.random() * 100) < this.actionFollow) {

			if (this.x != fjsRDunjonWorld.charList[0].x && this.y != fjsRDunjonWorld.charList[0].y) {

				if (Math.random() < 0.5) {

					if (this.x < fjsRDunjonWorld.charList[0].x) {
						ex++;
					} else {
						ex--;
					}

				} else {

					if (this.y < fjsRDunjonWorld.charList[0].y) {
						ey++;
					} else {
						ey--;
					}

				}

				if (fjsRDunjonWorld.canMove(ex, ey)) {

					this.x = ex;
					this.y = ey;


				}

				return;

			} else {

				if (this.x != fjsRDunjonWorld.charList[0].x) {

					if (this.x < fjsRDunjonWorld.charList[0].x) {
						ex++;
					} else {
						ex--;
					}

				}

				if (this.y != fjsRDunjonWorld.charList[0].y) {

					if (this.y < fjsRDunjonWorld.charList[0].y) {
						ey++;
					} else {
						ey--;
					}

				}

				if (fjsRDunjonWorld.canMove(ex, ey)) {

					this.x = ex;
					this.y = ey;


				}

				return;

			}

		}

		if (Math.random() * 100 < this.actionMove) {

			if (Math.random() < 0.5) {

				ex = this.x + Math.floor(Math.random() * 3) - 1;
				ey = this.y;

			} else {

				ex = this.x;
				ey = this.y + Math.floor(Math.random() * 3) - 1;

			}

			if (fjsRDunjonWorld.canMove(ex, ey)) {

				this.x = ex;
				this.y = ey;

			}

		}

	}

}

var fjsRDunjonWorld = new fjsRDunjonWorldTemplate();

var fjsRDunjonSTATE_START = 0;
var fjsRDunjonSTATE_GAME = 1;
var fjsRDunjonSTATE_CLEAR = 2;
var fjsRDunjonSTATE_OVER = 3;

var fjsRDunjonState = fjsRDunjonSTATE_START;

// æ–¹å‘ã‚­ãƒ¼çŠ¶æ…‹
var fjsRDunjonStick = 0;

var fjsRDunjonTimerID = 0;

var fjsRDunjonCellBG = '#808080';
var fjsRDunjonDamageCellBG = '#cc9999';

var fjsRDunjonAttackingEnemy = null;
var fjsRDunjonCount = 0;
var fjsOnPause = false;

var fjsGameMessage = null;

fjsRDunjonInit();

function fjsRDunjonInit() {

	// è¡¨ç¤ºç”¨HTML
	var html = '';
	var i;

	html = html + '<div id="fjsRDunjonHolder" style="padding: 0; margin-top: 0; margin-bottom: 0; margin-left: auto; margin-right: auto; width: 225px; background: #66aacc;" onKeyDown="fjsRDunjonKeyDown(event)" onKeyUp="fjsRDunjonKeyUp(event)" onClick="fjsRDunjonSetFocus()">' + "\n";

	html = html + '<div id="fjsRDunjonLevelLabel" style="color: #000000; padding: 0; margin: 0; background: #cccccc; font-size: 12px; font-family: monospace; text-align: center;">åœ°ä¸‹1éš</div>';
	html = html + '<div id="fjsRDunjonStatusHP" style="color: #ffffff; padding: 0; margin: 0; background: #000000; font-size: 12px; font-family: monospace; text-align: left;"><table style="padding: 0; margin: 0;"><tr style="padding: 0; margin: 0;"><td style="padding: 0; margin: 0; color: #ffffff; font-size: 14px; font-family: monospace;">HP</td><td style="padding: 0; margin: 0; text-align: left;"><div style="padding: 0; margin: 0; text-align: left;"><div id="fjsRDunjonStatusMaxHPBar" style="padding: 0; margin: 0; height: 12px; background: #cc0066;"><div id="fjsRDunjonStatusHPBar" style="padding: 0; margin: 0; height: 12px; background: #00cc00;"></div></div></div></td></tr></table></div>';

	html = html + '<div id="fjsRDunjonEnemyHP" style="color: #ffffff; padding: 0; margin: 0; background: #000000; text-align: left;"><table style="padding: 0; margin: 0;"><tr style="padding: 0; margin: 0;"><td id="fjsRDunjonEnemyName" style="padding: 0; margin: 0; color: #ffffff; font-size: 14px; font-family: monospace; text-align: left;">æ•µ</td><td style="padding: 0; margin: 0; text-align: left;"><div style="padding: 0; margin: 0; text-align: left;"><div id="fjsRDunjonEnemyMaxHPBar" style="padding: 0; margin: 0; height: 12px; background: #cc0066;"><div id="fjsRDunjonEnemyHPBar" style="padding: 0; margin: 0; height: 12px; background: #00cc00;"></div></div></div></td></tr></table></div>';

	html = html + '<div id="fjsRDunjonStatusArea" style="color: #000000; padding: 0; margin: 0; background: #99cc99; font-size: 12px; font-family: monospace; text-align: left;">çµŒé¨“å€¤</div>';

	html = html + '<div style="color: #ffffe0; background: #ffffe0; text-align: left;"><input type="text" id="fjsRDunjonFocusButton" style="border: none; width: 1px; height: 1px;"></div>' + "\n";

	html = html + '<table style="padding: 0; margin: 0; background: #000000;" cellspacing="0" cellpadding="0">' + "\n";

	// ã‚²ãƒ¼ãƒ ç”»é¢HTMLã‚¿ã‚°ä½œæˆ
	for (i = 0;i < fjsRDunjonWorld.MAP_ROWS;i++) {

		html = html + '<tr style="padding: 0; margin: 0;">' + "\n";

		for (j = 0;j < fjsRDunjonWorld.MAP_COLS;j++) {

			html = html + '<td id="fjsRDunjonCell' + Number(j).toString(16) + Number(i).toString(16) + '" style="background: #000000; color: #ffffff; font-size: 12px; font-family: monospace; text-align: center; padding: 0; margin: 0; width: 15px; height: 15px;"></td>';

		}

		html = html + '</tr>' + "\n";

	}

	html = html + "</table>\n";

	html = html + "</div>\n";

	// ã‚²ãƒ¼ãƒ HTMLã‚’è¡¨ç¤º
	document.write(html);

	// ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
	fjsRDunjonReset();

	// ã‚²ãƒ¼ãƒ ç”»é¢æç”»
	fjsRDunjonDraw();

	// ã‚²ãƒ¼ãƒ å‡¦ç†é–¢æ•°ã‚’å‘¼ã³å‡ºã™
	fjsRDunjonTimerID = setTimeout("fjsRDunjonProcess()", 40);

}

function fjsRDunjonSetFocus() {
	document.getElementById("fjsRDunjonFocusButton").focus();
}

// ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
function fjsRDunjonReset() {

	var elm;

	fjsRDunjonWorld.reset();

	fjsRDunjonWorld.newLevel(0);

	document.getElementById("fjsRDunjonHolder").focus();

	fjsRDunjonState = fjsRDunjonSTATE_START;
	fjsGameMessage = "ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼ã§é–‹å§‹";

	fjsRDunjonAttackingEnemy = null;

	elm = document.getElementById('fjsRDunjonEnemyName');

	elm.innerHTML = "æ•µ";

	elm = document.getElementById('fjsRDunjonEnemyMaxHPBar');

	elm.style.width = '0px';
	elm.style.height = '12px';

	elm = document.getElementById('fjsRDunjonEnemyHPBar');

	elm.style.width = '0px';
	elm.style.height = '12px';

}

// ã‚²ãƒ¼ãƒ æç”»
function fjsRDunjonDraw() {

	var i;
	var j;
	var messageX;
	var messageY;
	var mesBG;

	var elm;

	// åºŠã‚’ã‚¯ãƒªã‚¢
	for (i = 0;i < fjsRDunjonWorld.MAP_ROWS;i++) {
		for (j = 0;j < fjsRDunjonWorld.MAP_COLS;j++) {
			if (fjsRDunjonWorld.map[j][i] == 0) {

				elm = document.getElementById('fjsRDunjonCell' + Number(j).toString(16) + Number(i).toString(16));

				elm.style.background = fjsRDunjonCellBG;

				elm.innerHTML = '';

			}
		}
	}

	// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿æç”»
	for (i = 0;i < fjsRDunjonWorld.charList.length;i++) {
		if (fjsRDunjonWorld.charList[i].hp > 0) {

			elm = document.getElementById('fjsRDunjonCell' + Number(fjsRDunjonWorld.charList[i].x).toString(16) + Number(fjsRDunjonWorld.charList[i].y).toString(16));

			// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãŒãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã¦ã„ãŸã‚‰èƒŒæ™¯è‰²è¨­å®š
			if (fjsRDunjonWorld.charList[i].damage > 0) {
				elm.style.background = fjsRDunjonDamageCellBG;
			}

			if (i == 0) {

				// ä¸»äººå…¬ãªã‚‰é’
				elm.style.color = '#0000ff';

			} else {

				// æ•µ
				if (fjsRDunjonWorld.charList[i].type == 11) {
					elm.style.color = '#ffcccc';
				} else {
					elm.style.color = '#ffffff';
				}

			}

			// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿æ–‡å­—è¨­å®š
			elm.innerHTML = fjsRDunjonWorld.charList[i].chr;

		}
	}

	elm = document.getElementById('fjsRDunjonStatusMaxHPBar');

	// HPæœ€å¤§å€¤ã‚°ãƒ©ãƒ•è¡¨ç¤º
	elm.style.width = fjsRDunjonWorld.charList[0].mhp + 'px';

	elm = document.getElementById('fjsRDunjonStatusHPBar');

	// ç¾åœ¨HPã‚°ãƒ©ãƒ•è¡¨ç¤º
	elm.style.width = fjsRDunjonWorld.charList[0].hp + 'px';

	// æ”»æ’ƒä¸­ã®æ•µã‚­ãƒ£ãƒ©ã‚¯ã‚¿æƒ…å ±è¡¨ç¤º
	if (fjsRDunjonAttackingEnemy != null) {

		elm = document.getElementById('fjsRDunjonEnemyName');

		elm.innerHTML = fjsRDunjonAttackingEnemy.name;

		elm = document.getElementById('fjsRDunjonEnemyMaxHPBar');

		elm.style.width = fjsRDunjonAttackingEnemy.mhp + 'px';

		elm = document.getElementById('fjsRDunjonEnemyHPBar');

		elm.style.width = fjsRDunjonAttackingEnemy.hp + 'px';

	}

	elm = document.getElementById('fjsRDunjonStatusArea');

	elm.innerHTML = 'HP:' + fjsRDunjonWorld.charList[0].hp + '/' + fjsRDunjonWorld.charList[0].mhp + ' æ”»æ’ƒåŠ›:' + fjsRDunjonWorld.charList[0].at + ' å®ˆå‚™åŠ›:' + fjsRDunjonWorld.charList[0].def + '<br>çµŒé¨“å€¤:' + fjsRDunjonWorld.charList[0].exp;

	// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ—æç”»
	if (fjsGameMessage != null) {

		if (fjsRDunjonCount % 8 < 4) {
			mesBG = '#333333';
		} else {
			mesBG = '#000000';
		}

		messageY = Math.floor(fjsRDunjonWorld.MAP_ROWS / 2);
		messageX = Math.floor((fjsRDunjonWorld.MAP_COLS - fjsGameMessage.length) / 2);

		for (i = 0;i < fjsGameMessage.length;i++) {

			elm = document.getElementById('fjsRDunjonCell' + Number(messageX + i).toString(16) + Number(messageY).toString(16));

			elm.style.color = '#ffffff';
			elm.style.background = mesBG;

			elm.innerHTML = fjsGameMessage.charAt(i);

		}

	}

}

// ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
function fjsRDunjonProcess() {

	if (!fjsOnPause) {
		fjsRDunjonGame();
	}

	fjsRDunjonCount++;

	fjsRDunjonDraw();

	fjsRDunjonTimerID = setTimeout("fjsRDunjonProcess()", 40);

}

// ã‚²ãƒ¼ãƒ å‡¦ç†
function fjsRDunjonGame() {

	var i;
	var j;
	var elm;

	switch (fjsRDunjonState) {

	case fjsRDunjonSTATE_START:

		// ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼å…¥åŠ›ã§ã‚²ãƒ¼ãƒ é–‹å§‹
		if (fjsRDunjonStick != 0) {

			fjsRDunjonState = fjsRDunjonSTATE_GAME;
			clearGameMessage();

		}

		return;

	case fjsRDunjonSTATE_OVER:
	case fjsRDunjonSTATE_CLEAR:

		return;

	}

	var i;
	var ex, ey;

	var dx = 0, dy = 0;
	var attack = false;
	var action = false;

	fjsRDunjonWorld.levelProcess();

	for (i = 0;i < fjsRDunjonWorld.charList.length;i++) {

		// å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ•ãƒ©ã‚°ã‚’ã‚¯ãƒªã‚¢
		fjsRDunjonWorld.charList[i].damage = 0;

		// å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ã®è¡Œå‹•å¯èƒ½ã‚«ã‚¦ãƒ³ã‚¿ã‚’æ¸›ç®—
		if (fjsRDunjonWorld.charList[i].actionPoint > 0) {
			fjsRDunjonWorld.charList[i].actionPoint--;
		}

	}

	// ä¸»äººå…¬ãŒè¡Œå‹•å¯èƒ½ãªã‚‰è¡Œå‹•å‡¦ç†
	if (fjsRDunjonWorld.charList[0].actionPoint < 1) {

		// ä¸Šã‚­ãƒ¼æŠ¼ä¸‹
		if (fjsRDunjonStick == 1) {
			dy = -1;
		}

		// ä¸‹ã‚­ãƒ¼æŠ¼ä¸‹
		if (fjsRDunjonStick == 2) {
			dy = 1;
		}

		// å·¦ã‚­ãƒ¼æŠ¼ä¸‹
		if (fjsRDunjonStick == 4) {
			dx = -1;
		}

		// å³ã‚­ãƒ¼æŠ¼ä¸‹
		if (fjsRDunjonStick == 8) {
			dx = 1;
		}

		// ç§»å‹•å‡¦ç†
		if (dx != 0 || dy != 0) {

			i = 1;

			// æ•µã¨æ¥è§¦çŠ¶æ…‹ã§æ•µæ–¹å‘ã®ã‚­ãƒ¼æŠ¼ä¸‹ãªã‚‰æ”»æ’ƒ
			while (fjsRDunjonWorld.charList.length > i) {

				if (fjsRDunjonWorld.charList[i].hp > 0 && (fjsRDunjonWorld.charList[0].x + dx) == fjsRDunjonWorld.charList[i].x && (fjsRDunjonWorld.charList[0].y + dy) == fjsRDunjonWorld.charList[i].y) {

					fjsRDunjonAttackingEnemy = fjsRDunjonWorld.charList[i];

					fjsRDunjonWorld.attack(fjsRDunjonWorld.charList[0], fjsRDunjonAttackingEnemy);

					attack = true;
					action = true;

					break;

				}

				i++;

			}

			// ç©´ã«å…¥ã£ãŸã‚‰æ¬¡ã®éšã¸
			if (!attack && fjsRDunjonWorld.isHole(fjsRDunjonWorld.charList[0].x + dx, fjsRDunjonWorld.charList[0].y + dy)) {

				fjsRDunjonWorld.nextLevel();

				return;

			}

			// ç§»å‹•å¯èƒ½ãªã‚‰ç§»å‹•
			if (!attack && fjsRDunjonWorld.canMove(fjsRDunjonWorld.charList[0].x + dx, fjsRDunjonWorld.charList[0].y + dy)) {

				fjsRDunjonWorld.charList[0].x += dx;
				fjsRDunjonWorld.charList[0].y += dy;

				action = true;

			}

			// è¡Œå‹•å¯èƒ½ã‚«ã‚¦ãƒ³ã‚¿ã‚’åˆæœŸåŒ–
			if (action) {
				fjsRDunjonWorld.charList[0].actionPoint = fjsRDunjonWorld.charList[0].actionCharge;
			}

		}

	}

	i = 1;

	// æ•µã®è¡Œå‹•å‡¦ç†
	while (fjsRDunjonWorld.charList.length > i) {
		fjsRDunjonWorld.charList[i++].action();
	}

}

function clearGameMessage() {

	fjsGameMessage = null;

	// ã‚²ãƒ¼ãƒ ç”»é¢ã‚¯ãƒªã‚¢
	for (i = 0;i < fjsRDunjonWorld.MAP_ROWS;i++) {
		for (j = 0;j < fjsRDunjonWorld.MAP_COLS;j++) {

			elm = document.getElementById('fjsRDunjonCell' + Number(j).toString(16) + Number(i).toString(16));

			// ãƒãƒƒãƒ—è¦ç´ æç”»
			switch (fjsRDunjonWorld.map[j][i]) {

			case 0:

				elm.style.background = fjsRDunjonCellBG;

				break;

			case 2:

				elm.style.background = '#000000';

				break;

			case 4:

				elm.style.background = '#e0e0ff';

				break;

			}

			elm.innerHTML = '';

		}
	}

}

// ã‚­ãƒ¼æŠ¼ä¸‹ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
function fjsRDunjonKeyDown(e) {

	var code = 0;

	code = e.keyCode;

	// ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼æŠ¼ä¸‹çŠ¶æ…‹ã«å¿œã˜ã¦æ–¹å‘ã‚­ãƒ¼ãƒ•ãƒ©ã‚°è¨­å®š
	switch (code) {

	// ä¸Šã‚­ãƒ¼
	case 38:

		fjsRDunjonStick |= 1;

		break;

	// ä¸‹ã‚­ãƒ¼
	case 40:

		fjsRDunjonStick |= 2;

		break;

	// å·¦ã‚­ãƒ¼
	case 37:

		fjsRDunjonStick |= 4;

		break;

	// å³ã‚­ãƒ¼
	case 39:

		fjsRDunjonStick |= 8;

		break;

	}

}

// ã‚­ãƒ¼è§£æ”¾ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
function fjsRDunjonKeyUp(e) {

	var code = 0;

	code = e.keyCode;

	// ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼æŠ¼ä¸‹çŠ¶æ…‹ã«å¿œã˜ã¦æ–¹å‘ã‚­ãƒ¼ãƒ•ãƒ©ã‚°è¨­å®š
	switch (code) {

	// ä¸Šã‚­ãƒ¼
	case 38:

		fjsRDunjonStick &= ~1;

		break;

	// ä¸‹ã‚­ãƒ¼
	case 40:

		fjsRDunjonStick &= ~2;

		break;

	// å·¦ã‚­ãƒ¼
	case 37:

		fjsRDunjonStick &= ~4;

		break;

	// å³ã‚­ãƒ¼
	case 39:

		fjsRDunjonStick &= ~8;

		break;

	// ãƒªã‚¿ãƒ¼ãƒ³ã‚­ãƒ¼
	case 13:

		switch (fjsRDunjonState) {

		// ã‚²ãƒ¼ãƒ ä¸­ãªã‚‰ãƒãƒ¼ã‚ºåˆ‡ã‚Šæ›¿ãˆ
		case fjsRDunjonSTATE_GAME:

			fjsOnPause = !fjsOnPause;

			if (fjsOnPause) {
				fjsGameMessage = "ãƒãƒ¼ã‚ºä¸­";
			} else {
				clearGameMessage();
			}

			break;

		// ã‚²ãƒ¼ãƒ çµ‚äº†çŠ¶æ…‹ãªã‚‰ãƒªã‚»ãƒƒãƒˆ
		case fjsRDunjonSTATE_OVER:
		case fjsRDunjonSTATE_CLEAR:

			fjsRDunjonReset();

			break;

		}

		break;

	}

}
</script>
		 </body>
</html>
