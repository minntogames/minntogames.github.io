<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>ÂÆáÂÆô„ÇØ„É™„ÉÉ„Ç´„Éº„Ç≤„Éº„É†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            color: #e0e7ff; /* Light text color */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Prevent scroll */
            user-select: none; /* Disable text selection */
            -webkit-user-select: none; /* For Safari */
            -moz-user-select: none; /* For Firefox */
            -ms-user-select: none; /* For IE/Edge */
            cursor: default; /* Change cursor to default pointer */

            /* Base gradient and some subtle nebula effects */
            background:
                radial-gradient(circle at 10% 20%, rgba(30, 30, 80, 0.5) 0%, transparent 60%),
                radial-gradient(circle at 90% 80%, rgba(50, 20, 70, 0.5) 0%, transparent 60%),
                linear-gradient(to bottom, #0a0a0f, #1a1a2e); /* Main dark background */
        }

        /* Pseudo-elements for star layers */
        body::before, body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Behind content */
            background-repeat: repeat;
        }

        /* Layer 1: Distant, small, dense stars */
        body::before {
            background-image: radial-gradient(1.5px 1.5px at 10% 20%, #fff, transparent),
                              radial-gradient(1.5px 1.5px at 30% 70%, #fff, transparent),
                              radial-gradient(1.5px 1.5px at 60% 10%, #fff, transparent),
                              radial-gradient(1.5px 1.5px at 80% 90%, #fff, transparent),
                              radial-gradient(1.5px 1.5px at 5% 50%, #fff, transparent),
                              radial-gradient(1.5px 1.5px at 40% 40%, #fff, transparent);
            background-size: 800px 800px;
            animation: star-move-1 120s linear infinite;
        }

        /* Layer 2: Medium-sized, less dense stars */
        body::after {
            background-image: radial-gradient(2.5px 2.5px at 15% 85%, #fff, transparent),
                              radial-gradient(2.5px 2.5px at 70% 30%, #fff, transparent),
                              radial-gradient(2.5px 2.5px at 25% 60%, #fff, transparent),
                              radial-gradient(2.5px 2.5px at 95% 5%, #fff, transparent);
            background-size: 1500px 1500px;
            animation: star-move-2 200s linear infinite; /* Slower */
        }

        @keyframes star-move-1 {
            from { background-position: 0 0; }
            to { background-position: 800px 800px; }
        }

        @keyframes star-move-2 {
            from { background-position: 0 0; }
            to { background-position: -1500px -1500px; } /* Different direction */
        }

        .container {
            max-width: 90%;
            width: 100%;
            background-color: rgba(26, 26, 46, 0.8); /* Slightly transparent dark background */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            height: 90vh; /* Maximize vertical space */
            margin: 20px auto;
        }
        .menu-button {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }
        .sidebar {
            width: 250px;
            min-width: 250px;
            background-color: #2a2a4a; /* Darker sidebar */
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 90;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            padding-top: 80px; /* Space for menu button */
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
        }
        .sidebar.open {
            transform: translateX(0);
        }

        /* New Upgrade Sidebar */
        .upgrades-sidebar {
            width: 300px; /* Slightly wider for upgrades */
            min-width: 300px;
            background-color: #2a2a4a; /* Darker sidebar */
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 950; /* Higher than main sidebar, lower than modals */
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            padding: 20px;
            border-top-left-radius: 20px;
            border-bottom-left-radius: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }
        .upgrades-sidebar.open {
            transform: translateX(0);
        }
        .upgrades-sidebar-content {
            flex-grow: 1;
            overflow-y: auto; /* Allow scrolling for upgrade list */
            padding-right: 10px; /* Space for scrollbar */
        }
        .upgrades-sidebar .modal-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
        }


        .main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; /* Allow scrolling for content */
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .star-clicker {
            width: 200px;
            height: 200px;
            font-size: 150px; /* Star emoji size */
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s ease-out;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: pulse 2s infinite; /* Pulsing effect for the star */
        }
        .star-clicker:active {
            transform: scale(0.95);
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .upgrade-item {
            background-color: #3b3b6b;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column; /* Changed to column for better layout with batch buttons */
            align-items: flex-start; /* Align content to the start */
            justify-content: space-between;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .upgrade-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px; /* Space before buttons */
        }
        .upgrade-actions {
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap */
            gap: 5px; /* Space between buttons */
            width: 100%;
            justify-content: flex-end; /* Align buttons to the right */
        }
        .upgrade-actions button {
            background-color: #6a6aff;
            color: white;
            padding: 8px 12px; /* Smaller padding for batch buttons */
            border-radius: 8px; /* Slightly smaller radius */
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2); /* Smaller shadow */
            font-size: 0.85rem; /* Smaller font size */
            flex-grow: 1; /* Allow buttons to grow */
            min-width: 50px; /* Minimum width for small buttons */
        }
        .upgrade-actions button:hover {
            background-color: #4a4acb;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        /* Explicitly for disabled state to override default hover/active */
        .upgrade-actions button[disabled] {
            background-color: #6b7280 !important; /* Tailwind gray-500, use !important to ensure override */
            cursor: not-allowed !important;
            pointer-events: none; /* Disables all mouse events, including hover */
            box-shadow: none !important; /* Remove shadow when disabled */
            opacity: 0.7; /* Slightly dim it */
        }
        .upgrade-icon {
            font-size: 2.5em; /* Larger icon */
            margin-right: 15px; /* Space between icon and text */
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #2a2a4a;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
            position: relative; /* For close button positioning */
        }
        .modal.open .modal-content {
            transform: translateY(0);
        }
        .modal-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            color: #ccc;
            cursor: pointer;
            padding: 5px;
        }
        .modal-button {
            background-color: #ff6b6b;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            margin: 10px;
            transition: background-color 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .modal-button.confirm {
            background-color: #6aff6a;
        }
        .modal-button:hover {
            background-color: #e04a4a;
        }
        .modal-button.confirm:hover {
            background-color: #4acb4a;
        }

        /* Release Notes and Credits specific styles */
        .release-notes-content, .credits-content, .inventory-content, .excavation-content {
            text-align: left;
            max-height: 400px; /* Limit height for scrolling */
            overflow-y: auto;
            padding: 10px;
            background-color: #1a1a2e;
            border-radius: 10px;
            margin-top: 20px;
        }
        .release-notes-item, .credits-item, .inventory-item, .excavation-planet-item {
            background-color: #2a2a4a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .release-notes-item:last-child, .credits-item:last-child, .inventory-item:last-child, .excavation-planet-item:last-child {
            margin-bottom: 0;
        }
        .release-notes-item h4, .credits-item h4, .inventory-item h4, .excavation-planet-item h4 {
            font-size: 1.1em;
            font-weight: bold;
            color: #93c5fd; /* blue-300 */
            margin-bottom: 5px;
        }
        .release-notes-item p, .credits-item p, .inventory-item p, .excavation-planet-item p {
            font-size: 0.9em;
            color: #cbd5e1; /* slate-300 */
        }

        /* Volume slider specific styles */
        .volume-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
            color: #e0e7ff;
        }
        .volume-control input[type="range"] {
            width: 70%;
            -webkit-appearance: none;
            height: 8px;
            background: #4a4a6b;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a6aff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .volume-control input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a6aff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .volume-icon svg {
            width: 24px;
            height: 24px;
            transition: color 0.2s ease-in-out; /* Smooth color transition for icon */
        }

        /* Excavation cooldown bar */
        .cooldown-bar-wrapper {
            width: 100%;
            background-color: #4a4a6b;
            border-radius: 5px;
            overflow: hidden;
            height: 10px;
            margin-top: 5px;
        }
        .cooldown-bar {
            height: 100%;
            background-color: #6a6aff;
            width: 0%;
            transition: width 0.1s linear; /* Smooth transition for bar fill */
        }

        .excavation-cooldown-display {
            display: none; /* ÂàùÊúü„ÅØÈùûË°®Á§∫ */
            font-size: 0.9em;
            color: #cbd5e1;
            margin-top: 5px;
            text-align: center;
        }

        /* Batch buy button container */
        .batch-buy-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(42, 42, 74, 0.8);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .batch-cycle-button {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
            text-align: center;
            color: white;
            background-color: #6a6aff; /* Default color */
        }
        .batch-cycle-button:hover {
            background-color: #4a4acb;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .batch-cycle-button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">
    <!-- Hamburger Menu Button -->
    <button id="menu-button" class="menu-button p-3 rounded-full bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Sidebar Navigation (Left) -->
    <nav id="sidebar" class="sidebar fixed top-0 left-0 w-64 h-full bg-gray-900 shadow-lg text-white p-6 transform -translate-x-full transition-transform duration-300 ease-in-out z-50 rounded-r-lg">
        <ul class="space-y-4 pt-10">
            <li>
                <a href="#" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-modal="upgrades-sidebar-modal" data-scroll-to="regular-upgrades-section">ÂÖ®„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ</a>
            </li>
            <li>
                <a href="#" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-modal="upgrades-sidebar-modal" data-scroll-to="one-time-upgrades-section">ÁâπÂà•„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ</a>
            </li>
            <!-- Breakthrough menu link is now hidden as breakthroughs are integrated directly -->
            <!-- <li>
                <a href="#" id="breakthrough-menu-link" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-modal="upgrades-sidebar-modal" data-scroll-to="breakthrough-upgrades-section" style="display: none;">ÈôêÁïåÁ™ÅÁ†¥</a>
            </li> -->
            <li>
                <a href="#" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-modal="inventory-modal">„Ç§„É≥„Éô„É≥„Éà„É™</a>
            </li>
            <li>
                <a href="#" id="excavation-menu-link" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-modal="excavation-modal" style="display: none;">ÊÉëÊòüÊé°Êéò</a>
            </li>
            <li>
                <a href="#" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-modal="settings-modal">Ë®≠ÂÆö</a>
            </li>
            <li>
                <a href="#" class="block px-4 py-2 text-lg font-semibold rounded-md hover:bg-gray-700 transition duration-200" data-action="rebig-bang">„É™„Éì„ÉÉ„Ç∞„Éê„É≥</a>
            </li>
        </ul>
    </nav>

    <div class="container relative flex flex-col md:flex-row items-stretch overflow-hidden">
        <!-- Main Content Area -->
        <main class="main-content flex-grow p-6">
            <!-- Game Section -->
            <section id="game" class="section active flex flex-col items-center justify-center h-full text-center relative">
                <h1 class="text-4xl md:text-5xl font-bold mb-6 text-blue-300">„Çπ„Çø„Éº„ÇØ„É™„ÉÉ„ÇØÔºÅ</h1>
                <p class="text-2xl mb-4">
                    Êòü„Åã„Çâ„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº: <br> <span id="energy-display" class="font-bold text-yellow-300">0</span>
                </p>

                <div id="star-clicker" class="star-clicker flex justify-center items-center rounded-full bg-gradient-to-br from-yellow-400 to-orange-500 shadow-xl border-4 border-yellow-200 cursor-pointer select-none mx-auto relative z-20">
                    ‚≠ê
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-8">
                    <p class="text-lg font-medium bg-gray-700 rounded-lg p-2 px-4 shadow-md">„ÇØ„É™„ÉÉ„ÇØ„Éë„ÉØ„Éº: <span id="click-power-display">1</span></p>
                    <p class="text-lg font-medium bg-gray-700 rounded-lg p-2 px-4 shadow-md">Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ: <span id="auto-click-display">0</span>/Áßí</p>
                    <!-- Heat Clicker Multiplier Display -->
                    <p id="heat-clicker-display-wrapper" class="text-lg font-medium bg-gray-700 rounded-lg p-2 px-4 shadow-md" style="display: none;">„Éí„Éº„Éà„ÇØ„É™„ÉÉ„ÇØ: <span id="heat-multiplier-display" class="font-bold" style="color: hsl(0, 0%, 100%);">1.0x</span></p>
                    <!-- Excavation Cooldown Display (appears when excavationLicense is purchased) -->
                    <p id="excavation-cooldown-display-wrapper" class="text-lg font-medium bg-gray-700 rounded-lg p-2 px-4 shadow-md" style="display: none;">Êé°Êéò„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥: <span id="excavation-cooldown-display" class="font-bold">Ê∫ñÂÇôÂÆå‰∫Ü</span></p>
                </div>
            </section>
        </main>
    </div>

    <!-- Upgrades Sidebar Modal (Right) -->
    <div id="upgrades-sidebar-modal" class="upgrades-sidebar">
        <button class="modal-close-button" data-action="close-modal">&times;</button>
        <h2 class="text-3xl md:text-4xl font-bold mb-8 text-purple-300 text-center">„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ</h2>

        <!-- Batch Buy Controls -->
        <div class="batch-buy-controls">
            <button id="batch-cycle-button" class="batch-cycle-button">Ë≥ºÂÖ•Èáè: x1</button>
        </div>

        <div class="upgrades-sidebar-content">
            <h3 id="regular-upgrades-section" class="text-xl font-bold mb-4 mt-6 text-gray-300">ÊÉëÊòü„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ</h3>
            <div id="regular-upgrade-list" class="grid grid-cols-1 gap-6">
                <!-- Regular Upgrade items will be dynamically inserted here -->
            </div>
            <h3 id="one-time-upgrades-section" class="text-xl font-bold mb-4 mt-6 text-gray-300">ÁâπÂà•„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ</h3>
            <div id="one-time-upgrade-list" class="grid grid-cols-1 gap-6">
                <!-- One-Time Upgrade items will be dynamically inserted here -->
            </div>
            <!-- Breakthrough Upgrades section header is now hidden -->
            <!-- <h3 id="breakthrough-upgrades-section" class="text-xl font-bold mb-4 mt-6 text-gray-300" style="display: none;">ÈôêÁïåÁ™ÅÁ†¥</h3> -->
            <!-- <div id="breakthrough-upgrade-list" class="grid grid-cols-1 gap-6"> -->
                <!-- Breakthrough Upgrade items will be dynamically inserted here -->
            <!-- </div> -->
        </div>
        <button id="close-upgrades-sidebar" class="mt-8 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 text-xl">
            Èñâ„Åò„Çã
        </button>
    </div>

    <!-- Inventory Modal -->
    <div id="inventory-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" data-action="close-modal">&times;</button>
            <h2 class="text-3xl md:text-4xl font-bold mb-8 text-yellow-300 text-center">„Ç§„É≥„Éô„É≥„Éà„É™</h2>
            <div id="inventory-content" class="inventory-content">
                <!-- Inventory items will be dynamically inserted here -->
            </div>
            <button id="close-inventory-modal" class="mt-8 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>

    <!-- Excavation Modal -->
    <div id="excavation-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" data-action="close-modal">&times;</button>
            <h2 class="text-3xl md:text-4xl font-bold mb-8 text-orange-300 text-center">ÊÉëÊòüÊé°Êéò</h2>
            <div id="excavation-planet-list" class="excavation-content">
                <!-- Excavation planet items will be dynamically inserted here -->
            </div>
            <button id="close-excavation-modal" class="mt-8 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>


    <!-- Generic Confirmation Modal -->
    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" data-action="close-modal">&times;</button>
            <p id="modal-message" class="text-xl mb-6 text-gray-200">„É°„ÉÉ„Çª„Éº„Ç∏</p>
            <div class="flex justify-center gap-4">
                <button id="modal-cancel" class="modal-button bg-gray-500 hover:bg-gray-600">„Ç≠„É£„É≥„Çª„É´</button>
                <button id="modal-confirm" class="modal-button confirm bg-red-600 hover:bg-red-700">„ÅØ„ÅÑ„ÄÅÂâäÈô§„Åó„Åæ„Åô</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" data-action="close-modal">&times;</button>
            <h2 class="text-3xl md:text-4xl font-bold mb-8 text-red-300 text-center">Ë®≠ÂÆö</h2>

            <!-- Volume Control -->
            <div class="volume-control">
                <span id="speaker-icon" class="volume-icon cursor-pointer">
                    <!-- SVG for volume icon, dynamically updated -->
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
                        <path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zM3 9v6h4l5 5V4L7 9H3z"/>
                    </svg>
                </span>
                <input type="range" id="volume-slider" min="0" max="100" value="50">
            </div>

            <button id="release-notes-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 text-xl mb-4">
                „É™„É™„Éº„Çπ„Éé„Éº„Éà
            </button>
            <button id="credits-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 text-xl mb-4">
                „ÇØ„É¨„Ç∏„ÉÉ„Éà
            </button>
            <button id="delete-data-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 text-xl mb-4">
                „Éá„Éº„Çø„ÇíÂâäÈô§
            </button>
            <button id="close-settings-modal" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>

    <!-- Release Notes Modal -->
    <div id="release-notes-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" data-action="close-modal">&times;</button>
            <h2 class="text-3xl md:text-4xl font-bold mb-8 text-blue-300 text-center">„É™„É™„Éº„Çπ„Éé„Éº„Éà</h2>
            <div id="release-notes-content" class="release-notes-content">
                <!-- Release notes will be dynamically inserted here -->
            </div>
            <button id="close-release-notes-modal" class="mt-8 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>

    <!-- Credits Modal -->
    <div id="credits-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" data-action="close-modal">&times;</button>
            <h2 class="text-3xl md:text-4xl font-bold mb-8 text-green-300 text-center">„ÇØ„É¨„Ç∏„ÉÉ„Éà</h2>
            <div id="credits-content" class="credits-content">
                <!-- Credits will be dynamically inserted here -->
            </div>
            <button id="close-credits-modal" class="mt-8 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>

    <!-- Audio Element -->
    <audio id="background-music" loop src="https://minntogames.github.io/minnntogames.github.io2/edge.wav"></audio>

    <script>
        // IndexedDBË®≠ÂÆö
        const DB_NAME = 'SpaceClickerDB';
        const STORE_NAME = 'gameState';
        const DB_VERSION = 1;
        const BASE_STRONG_START_ENERGY_REQUIREMENT = 1000000; // 100‰∏á„Ç®„Éç„É´„ÇÆ„Éº„ÅåÂü∫Êú¨„Ç≥„Çπ„Éà
        const MAX_INACTIVITY_MS = 24 * 60 * 60 * 1000; // 24ÊôÇÈñìÔºà„Éü„É™ÁßíÔºâ
        const HEAT_CLICKER_RESET_TIME_MS = 2000; // 2ÁßíÈñì„ÅÆÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Åß„Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÂÄçÁéá„Çí„É™„Çª„ÉÉ„Éà
        const HEAT_CLICKER_INCREMENT = 0.1; // „ÇØ„É™„ÉÉ„ÇØ„Åî„Å®„Å´ÂÄçÁéá„Åå„Åì„ÅÆÈáè„Å†„ÅëÂ¢óÂä†
        let MAX_HEAT_CLICK_MULTIPLIER = 2.0; // „Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„ÉºÂÄçÁéá„ÅÆÊúÄÂ§ßÂà∂Èôê (ÈôêÁïåÁ™ÅÁ†¥„ÅßÂ§âÂãï)
        const EXCAVATION_MIN_PLANET_LEVEL = 20; // Êé°ÊéòÂèØËÉΩ„Å™ÊÉëÊòü„ÅÆÊúÄ‰Ωé„É¨„Éô„É´

        // Êñ∞„Åó„ÅÑÊÉëÊòü„ÅÆÂÆöÁæ© (wideRangeTransfer „Åß„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„Çã)
        const newPlanetsData = {
            cometA: { level: 0, cost: 5e6, clickBonus: 1000, autoBonus: 10000, icon: '‚òÑÔ∏è', excavationCooldown: 240 * 1000 }, // 4ÂàÜ
            dwarfPlanet: { level: 0, cost: 1e7, clickBonus: 2000, autoBonus: 20000, icon: 'ü™ê', excavationCooldown: 300 * 1000 },  // 5ÂàÜ
            gasGiantMoon: { level: 0, cost: 5e7, clickBonus: 5000, autoBonus: 50000, icon: 'üåï', excavationCooldown: 480 * 1000 } // 8ÂàÜ
        };

        let db; // IndexedDB„Éá„Éº„Çø„Éô„Éº„Çπ„Ç§„É≥„Çπ„Çø„É≥„Çπ
        let gameState = {
            energy: 0, // ÈñãÁô∫Áî®„Å´1e101„Å´Ë®≠ÂÆö„Åó„Å¶„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅ0„Å´Êàª„Åó„Åæ„Åô
            clickPower: 1,
            autoClickPower: 0,
            strongStartLevel: 0, // Âº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„Åå‰ΩïÂõûÈñãÂßã„Åï„Çå„Åü„Åã„ÇíËøΩË∑°
            lastPlayedTime: Date.now(), // ÊúÄÂæå„ÅÆÊ¥ªÂãïÊôÇÈñì„Çí‰øùÂ≠ò
            heatClickMultiplier: 1.0, // „Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÂÄçÁéá
            lastClickTime: Date.now(), // Êòü„ÅåÊúÄÂæå„Å´„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„ÅüÊôÇÈñì
            selectedBatchAmount: 1, // ÁèæÂú®ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Éê„ÉÉ„ÉÅË≥ºÂÖ•Èáè (x1, x10, etc.)
            upgrades: {
                mercury: { level: 0, cost: 10, clickBonus: 1, autoBonus: 0, icon: '‚òø', excavationCooldown: 10 * 1000 }, // 10Áßí
                venus: { level: 0, cost: 50, clickBonus: 3, autoBonus: 0, icon: '‚ôÄ', excavationCooldown: 15 * 1000 }, // 15Áßí
                earth: { level: 0, cost: 200, clickBonus: 0, autoBonus: 5, icon: 'üåé', excavationCooldown: 20 * 1000 }, // 20Áßí
                mars: { level: 0, cost: 1000, clickBonus: 10, autoBonus: 0, icon: '‚ôÇ', excavationCooldown: 30 * 1000 }, // 30Áßí
                jupiter: { level: 0, cost: 5000, clickBonus: 0, autoBonus: 50, icon: '‚ôÉ', excavationCooldown: 45 * 1000 }, // 45Áßí
                saturn: { level: 0, cost: 25000, clickBonus: 0, autoBonus: 200, icon: '‚ôÑ', excavationCooldown: 60 * 1000 }, // 60Áßí (1ÂàÜ)
                uranus: { level: 0, cost: 100000, clickBonus: 50, autoBonus: 0, icon: '‚õ¢', excavationCooldown: 90 * 1000 }, // 90Áßí (1.5ÂàÜ)
                neptune: { level: 0, cost: 500000, clickBonus: 0, autoBonus: 1000, icon: '‚ôÜ', excavationCooldown: 120 * 1000 }, // 120Áßí (2ÂàÜ)
                originalPlanetX: { level: 0, cost: 2000000, clickBonus: 500, autoBonus: 5000, icon: 'ü™ê', excavationCooldown: 180 * 1000 }, // 180Áßí (3ÂàÜ)
                // Êñ∞„Åó„ÅÑ‰∏ÄÂõûÈôê„Çä„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ
                cosmicDrill: { level: 0, initialCost: 1e7, cost: 1e7, clickBonus: 10000, autoBonus: 0, icon: '‚õèÔ∏è', maxLevel: 1 },
                galacticReactor: { level: 0, initialCost: 5e7, cost: 5e7, clickBonus: 0, autoBonus: 10000, icon: '‚öõÔ∏è', maxLevel: 1 },
                heatClicker: { level: 0, initialCost: 1e6, cost: 1e6, clickBonus: 0, autoBonus: 0, icon: 'üî•', maxLevel: 1, currentMaxMultiplier: 2.0 }, // „Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº
                excavationLicense: { level: 0, initialCost: 1e5, cost: 1e5, clickBonus: 0, autoBonus: 0, icon: 'üìú', maxLevel: 1 }, // Êé°Êéò„É©„Ç§„Çª„É≥„Çπ
                wideRangeTransfer: { level: 0, initialCost: 1e8, cost: 1e8, clickBonus: 0, autoBonus: 0, icon: 'üì°', maxLevel: 1, unlockedPlanets: [], breakthroughLevel: 0 }, // „Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÊÉëÊòü„ÇíËøΩË∑°, ÈôêÁïåÁ™ÅÁ†¥„É¨„Éô„É´
                // ÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ
                heatClickerBreakthrough: { level: 0, initialCost: 1e6, cost: 1e6, itemCost: { ironOre: 100, silverOre: 10 }, targetUpgrade: 'heatClicker', maxLevel: 5, icon: 'üí•', effect: 0.2, type: 'breakthrough' }, // „Ç¢„Ç§„ÉÜ„É†Ê∂àË≤ª„Çí‰º¥„ÅÜÈôêÁïåÁ™ÅÁ†¥, ÂäπÊûúÈáè
                wideRangeTransferBreakthrough: { level: 0, initialCost: 5e6, cost: 5e6, itemCost: { goldOre: 5, copperOre: 500 }, targetUpgrade: 'wideRangeTransfer', maxLevel: 3, icon: '‚ö°', unlocks: [ 'cometA', 'dwarfPlanet', 'gasGiantMoon' ], type: 'breakthrough' } // „Ç¢„É≥„É≠„ÉÉ„ÇØ„Åô„ÇãÊÉëÊòü„ÅÆ„É™„Çπ„Éà
            },
            volume: 0.5, // „Éá„Éï„Ç©„É´„ÉàÈü≥Èáè (0.0 „Åã„Çâ 1.0)
            inventory: { // „ÉÜ„Çπ„ÉàÁî®„Å´„ÅÑ„Åè„Å§„Åã„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíËøΩÂä†
                ironOre: 0,
                copperOre: 0,
                silverOre: 0,
                goldOre: 0
            },
            planetExcavationCooldowns: {} // ÂêÑÊÉëÊòü„ÅÆÊé°Êéò„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥ÊôÇÈñì
        };

        // „Ç¢„Ç§„ÉÜ„É†„ÅÆÂÆöÁæ©
        const itemData = {
            ironOre: { name: 'ÈâÑÈâ±Áü≥', icon: 'ü™®' },
            copperOre: { name: 'ÈäÖÈâ±Áü≥', icon: 'ü™®' },
            silverOre: { name: 'ÈäÄÈâ±Áü≥', icon: '‚ú®' },
            goldOre: { name: 'ÈáëÈâ±Áü≥', icon: 'üåü' }
        };

        // „É™„É™„Éº„Çπ„Éé„Éº„Éà„Éá„Éº„Çø
        const releaseNotesData = [
            { version: "v1.11", date: "2024-06-21", notes: "ÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Åå„ÄÅÂØæÂøú„Åô„ÇãÂÖÉ„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåË≥ºÂÖ•„Åï„Çå„Çã„Åæ„ÅßË°®Á§∫„Åï„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.10", date: "2024-06-21", notes: "ÊÉëÊòü„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆË°®Á§∫È†ÜÂ∫è„ÇíÂõ∫ÂÆö„Åó„Åæ„Åó„Åü„ÄÇÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çí„ÄÅÂΩ±Èüø„Çí‰∏é„Åà„Çã„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆÈ†ÖÁõÆÂÜÖ„Å´Áµ±Âêà„Åó„Åæ„Åó„Åü„ÄÇÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆË≥ºÂÖ•„Éú„Çø„É≥„ÇíËµ§Ëâ≤„Å´„Åó„Åæ„Åó„Åü„ÄÇÈü≥Ê•Ω„ÅÆ„Éá„Éï„Ç©„É´„ÉàÈü≥Èáè„Çí50%„Å´Ë®≠ÂÆö„Åó„Åæ„Åó„Åü„ÄÇ„Ç™„Éï„É©„Ç§„É≥„Ç®„Éç„É´„ÇÆ„Éº„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Éú„Çø„É≥ÂøúÁ≠î„Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.9", date: "2024-06-21", notes: "„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„ÉâÂàó„ÅÆË°®Á§∫È†Ü„Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ„Ç™„Éï„É©„Ç§„É≥„Ç®„Éç„É´„ÇÆ„Éº„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Éú„Çø„É≥ÂøúÁ≠î„Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.8", date: "2024-06-20", notes: "„Éê„ÉÉ„ÉÅË≥ºÂÖ•„Éú„Çø„É≥„ÇíÂçò‰∏Ä„ÅÆ„Éú„Çø„É≥„Å´Áµ±Âêà„Åó„ÄÅ„ÇØ„É™„ÉÉ„ÇØ„ÅßË≥ºÂÖ•Èáè„ÅåÂàá„ÇäÊõø„Çè„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åó„Åü„ÄÇ„Çµ„Ç§„Éâ„Éê„Éº„Å´„ÄåÈôêÁïåÁ™ÅÁ†¥„Äç„É°„Éã„É•„ÉºÈ†ÖÁõÆ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„Ç≥„Çπ„ÉàË°®Á§∫„ÇíÊîπÂñÑ„Åó„Åæ„Åó„Åü„ÄÇ„Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÂÄçÁéáË°®Á§∫„ÅÆËâ≤Ë™øÊï¥„Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.7", date: "2024-06-20", notes: "Êñ∞„Åó„ÅÑÁâπÊÆä„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÄåÈôêÁïåÁ™ÅÁ†¥„Äç„Å®„ÄåÂ∫ÉÁØÑÂõ≤Ëª¢ÈÄÅË£ÖÁΩÆ„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ„ÄåÈôêÁïåÁ™ÅÁ†¥„Äç„É°„Éã„É•„ÉºÈ†ÖÁõÆ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„Ç≥„Çπ„ÉàË°®Á§∫„ÇíÊîπÂñÑ„Åó„Åæ„Åó„Åü„ÄÇ„Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÂÄçÁéáË°®Á§∫„ÅÆËâ≤Ë™øÊï¥„Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„Éê„ÉÉ„ÉÅË≥ºÂÖ•UI„Çí‰∏ÄÂÖÉÂåñ„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.6", date: "2024-06-20", notes: "Êñ∞„Åó„ÅÑÁâπÊÆä„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÄåÈôêÁïåÁ™ÅÁ†¥„Äç„Å®„ÄåÂ∫ÉÁØÑÂõ≤Ëª¢ÈÄÅË£ÖÁΩÆ„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„Éê„ÉÉ„ÉÅË≥ºÂÖ•UI„ÇíÊîπÂñÑ„Åó„ÄÅ‰∏ÄÂÖÉÂåñ„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.5", date: "2024-06-20", notes: "ÊÉëÊòüÊé°Êéò„ÅÆ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„ÇíÊÉëÊòü„ÅÆ„Ç≥„Çπ„Éà„Å´Âøú„Åò„Å¶ÂãïÁöÑ„Å´Ë®≠ÂÆö„Åó„Åæ„Åó„Åü„ÄÇ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Å´„Éê„ÉÉ„ÉÅ„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÊ©üËÉΩÔºà+1, +10, +50, +100, MaxÔºâ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.4", date: "2024-06-20", notes: "Êñ∞„Åó„ÅÑ„Ç¢„Ç§„ÉÜ„É†„Å®ÊÉëÊòüÊé°ÊéòÊ©üËÉΩ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Éô„É≥„Éà„É™„ÇíÁ¢∫Ë™ç„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇË®≠ÂÆö„Å´„ÇØ„É¨„Ç∏„ÉÉ„Éà„Çª„ÇØ„Ç∑„Éß„É≥„ÇíËøΩÂä†„Åó„ÄÅ„Ç≤„Éº„É†„Å´BGM„ÇíËøΩÂä†„Åó„ÄÅË®≠ÂÆö„Å´Èü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº„Å®„Éü„É•„Éº„ÉàÊ©üËÉΩ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ„Çµ„Ç§„Éà„ÅÆ„Ç∫„Éº„É†„Å®„ÉÜ„Ç≠„Çπ„ÉàÈÅ∏Êäû„ÇíÁÑ°Âäπ„Å´„Åó„Åæ„Åó„Åü„ÄÇ„ÄåÂº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„Äç„Çí„Äå„É™„Éì„ÉÉ„Ç∞„Éê„É≥„Äç„Å´ÊîπÂêç„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.3", date: "2024-06-20", notes: "Ë®≠ÂÆö„Å´„ÇØ„É¨„Ç∏„ÉÉ„Éà„Çª„ÇØ„Ç∑„Éß„É≥„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.2", date: "2024-06-20", notes: "„Ç≤„Éº„É†„Å´BGM„ÇíËøΩÂä†„Åó„ÄÅË®≠ÂÆö„Å´Èü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº„Å®„Éü„É•„Éº„ÉàÊ©üËÉΩ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ" },
            { version: "v1.1", date: "2024-06-19", notes: "Êñ∞„Åó„ÅÑ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Å®Á¥∞„Åã„ÅÑË™øÊï¥" },
            { version: "v1.0", date: "2024-06-18", notes: "„Ç≤„Éº„É†„Åå„É™„É™„Éº„Çπ„Åï„Çå„Åæ„Åó„Åü" }
        ];

        // DOMË¶ÅÁ¥†
        const energyDisplay = document.getElementById('energy-display');
        const clickPowerDisplay = document.getElementById('click-power-display');
        const autoClickDisplay = document.getElementById('auto-click-display');
        const starClicker = document.getElementById('star-clicker');
        // ÂàÜÂâ≤„Åï„Çå„Åü„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„É™„Çπ„Éà
        const regularUpgradeList = document.getElementById('regular-upgrade-list');
        const oneTimeUpgradeList = document.getElementById('one-time-upgrade-list');
        // Breakthrough upgrades are now integrated, so these are commented out
        // const breakthroughUpgradeList = document.getElementById('breakthrough-upgrade-list');
        const breakthroughUpgradesSectionHeader = document.getElementById('breakthrough-upgrades-section'); // ÈôêÁïåÁ™ÅÁ†¥„Éò„ÉÉ„ÉÄ„Éº
        const heatClickerDisplayWrapper = document.getElementById('heat-clicker-display-wrapper'); // „Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„ÉºË°®Á§∫„ÅÆ„É©„ÉÉ„Éë„Éº
        const heatMultiplierDisplay = document.getElementById('heat-multiplier-display');
        const excavationCooldownDisplayWrapper = document.getElementById('excavation-cooldown-display-wrapper');
        const excavationCooldownDisplay = document.getElementById('excavation-cooldown-display');
        const breakthroughMenuLink = document.getElementById('breakthrough-menu-link'); // ÈôêÁïåÁ™ÅÁ†¥„É°„Éã„É•„Éº„É™„É≥„ÇØ

        const menuButton = document.getElementById('menu-button');
        const sidebar = document.getElementById('sidebar');
        const navLinks = document.querySelectorAll('#sidebar a');
        const sections = document.querySelectorAll('.section');

        // „É¢„Éº„ÉÄ„É´ / „Çµ„Ç§„Éâ„Éê„Éº
        const confirmationModal = document.getElementById('confirmation-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalCancelButton = document.getElementById('modal-cancel');
        const modalConfirmButton = document.getElementById('modal-confirm');
        const settingsModal = document.getElementById('settings-modal');
        const deleteDataButton = document.getElementById('delete-data-button');
        const closeSettingsModalButton = document.getElementById('close-settings-modal');
        const modalCloseButtons = document.querySelectorAll('.modal-close-button'); // „Çµ„Ç§„Éâ„Éê„Éº„É¢„Éº„ÉÄ„É´„ÅÆÊñ∞„Åó„ÅÑ„Éú„Çø„É≥„ÇíÂê´„ÇÄ

        // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çµ„Ç§„Éâ„Éê„Éº„É¢„Éº„ÉÄ„É´Ë¶ÅÁ¥†
        const upgradesSidebarModal = document.getElementById('upgrades-sidebar-modal');
        const closeUpgradesSidebarButton = document.getElementById('close-upgrades-sidebar');
        const batchCycleButton = document.getElementById('batch-cycle-button'); // Êñ∞„Åó„ÅÑÂçò‰∏Ä„Éê„ÉÉ„ÉÅË≥ºÂÖ•„Éú„Çø„É≥

        // „Ç§„É≥„Éô„É≥„Éà„É™„É¢„Éº„ÉÄ„É´Ë¶ÅÁ¥†
        const inventoryModal = document.getElementById('inventory-modal');
        const inventoryContent = document.getElementById('inventory-content');
        const closeInventoryModal = document.getElementById('close-inventory-modal');

        // Êé°Êéò„É¢„Éº„ÉÄ„É´Ë¶ÅÁ¥†
        const excavationMenuLink = document.getElementById('excavation-menu-link');
        const excavationModal = document.getElementById('excavation-modal');
        const excavationPlanetList = document.getElementById('excavation-planet-list');
        const closeExcavationModal = document.getElementById('close-excavation-modal');


        // „É™„É™„Éº„Çπ„Éé„Éº„Éà„É¢„Éº„ÉÄ„É´Ë¶ÅÁ¥†
        const releaseNotesButton = document.getElementById('release-notes-button');
        const releaseNotesModal = document.getElementById('release-notes-modal');
        const releaseNotesContent = document.getElementById('release-notes-content');
        const closeReleaseNotesModalButton = document.getElementById('close-release-notes-modal');

        // „ÇØ„É¨„Ç∏„ÉÉ„Éà„É¢„Éº„ÉÄ„É´Ë¶ÅÁ¥†
        const creditsButton = document.getElementById('credits-button');
        const creditsModal = document.getElementById('credits-modal');
        const creditsContent = document.getElementById('credits-content');
        const closeCreditsModalButton = document.getElementById('close-credits-modal');

        // „Ç™„Éº„Éá„Ç£„Ç™Ë¶ÅÁ¥†
        const audioElement = document.getElementById('background-music');
        const volumeSlider = document.getElementById('volume-slider');
        const speakerIcon = document.getElementById('speaker-icon');

        let currentConfirmCallback = null;
        let currentCancelCallback = null;
        let confirmationStep = 0; // Â§öÊÆµÈöéÂâäÈô§Á¢∫Ë™çÁî®
        let lastVolumeBeforeMute = gameState.volume; // „Éü„É•„Éº„ÉàÂâç„ÅÆÈü≥Èáè„Çí‰øùÂ≠ò
        const batchAmounts = [1, 10, 50, 100, 'max']; // „Éê„ÉÉ„ÉÅË≥ºÂÖ•„ÅÆÈÅ∏ÊäûËÇ¢

        // --- „Éò„É´„Éë„ÉºÈñ¢Êï∞ ---

        /**
         * Â§ß„Åç„Å™Êï∞ÂÄ§„ÇíÂçò‰Ωç (K, M, B, T) „Åß„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åó„Åæ„Åô„ÄÇ
         * @param {number} num - „Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åô„ÇãÊï∞ÂÄ§„ÄÇ
         * @returns {string} „Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åï„Çå„ÅüÊï∞ÂÄ§ÊñáÂ≠óÂàó„ÄÇ
         */
        function formatNumber(num) {
            if (num >= 1000000000000) {
                return (num / 1000000000000).toFixed(2) + 'T';
            }
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(2) + 'B';
            }
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(2) + 'K';
            }
            return Math.floor(num).toLocaleString();
        }

        /**
         * ÊÆã„ÇäÊôÇÈñì„ÇíHH:MM:SSÂΩ¢Âºè„Åß„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åó„Åæ„Åô„ÄÇ
         * @param {number} ms - ÊÆã„ÇäÊôÇÈñì („Éü„É™Áßí)„ÄÇ
         * @returns {string} „Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åï„Çå„ÅüÊôÇÈñìÊñáÂ≠óÂàó„ÄÇ
         */
        function formatTime(ms) {
            const totalSeconds = Math.max(0, Math.floor(ms / 1000));
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return [hours, minutes, seconds]
                .map(unit => String(unit).padStart(2, '0'))
                .join(':');
        }

        /**
         * „ÄåÂº∑Âäõ„Å™Êñ∞Ë¶è„Ç≤„Éº„É†„Äç„ÅÆÁèæÂú®„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„Ç≥„Çπ„Éà„ÇíË®àÁÆó„Åó„Åæ„Åô„ÄÇ
         * „Ç≥„Çπ„Éà„ÅØÂº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„É¨„Éô„É´„Å´Âøú„Åò„Å¶ÊåáÊï∞Èñ¢Êï∞ÁöÑ„Å´Â¢óÂä†„Åó„Åæ„Åô„ÄÇ
         * @returns {number} Ê¨°„ÅÆÂº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„Å´ÂøÖË¶Å„Å™„Ç®„Éç„É´„ÇÆ„Éº„ÄÇ
         */
        function getStrongStartCurrentCost() {
            // ÊåáÊï∞Èñ¢Êï∞ÁöÑ„Å™Â¢óÂä†„Çí„Çà„ÇäÈ°ïËëó„Å´„Åô„Çã„Åü„ÇÅ„Å´ Math.pow(2, ...) „Çí‰ΩøÁî®
            return BASE_STRONG_START_ENERGY_REQUIREMENT * Math.pow(2, gameState.strongStartLevel);
        }

        /**
         * „Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„ÉºË°®Á§∫„ÅÆHSLËâ≤„Çí„ÄÅÁôΩ„Åã„ÇâËµ§„Å∏Ë®àÁÆó„Åó„Åæ„Åô„ÄÇ
         * @param {number} multiplier - ÁèæÂú®„ÅÆ„Éí„Éº„Éà„ÇØ„É™„ÉÉ„ÇØÂÄçÁéá„ÄÇ
         * @returns {string} HSLËâ≤ÊñáÂ≠óÂàó„ÄÇ
         */
        function getHeatColor(multiplier) {
            const minMultiplier = 1.0;
            // currentMaxMultiplier„ÅåÊú™ÂÆöÁæ©„ÅÆÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
            const maxMultiplier = gameState.upgrades.heatClicker.currentMaxMultiplier !== undefined ? gameState.upgrades.heatClicker.currentMaxMultiplier : MAX_HEAT_CLICK_MULTIPLIER;
            // ÂÄçÁéá„ÇíÊúÄÂ∞è/ÊúÄÂ§ß„Å´Âü∫„Å•„ÅÑ„Å¶0-1„ÅÆÁØÑÂõ≤„Å´Ê≠£Ë¶èÂåñ
            const normalized = Math.max(0, Math.min(1, (multiplier - minMultiplier) / (maxMultiplier - minMultiplier)));

            // HSLÂÄ§„ÇíË£úÈñì„Åó„Åæ„Åô„ÄÇ
            // Ëâ≤Áõ∏ (H) „ÅØËµ§/ÁôΩ/„Ç∞„É¨„Éº„ÅÆÂ†¥Âêà0„ÅÆ„Åæ„Åæ„ÄÇ
            // ÂΩ©Â∫¶ (S) „ÅØ0%ÔºàÁôΩÔºâ„Åã„Çâ100%ÔºàËµ§Ôºâ„Å´Â§âÂåñ„ÄÇ
            // ÊòéÂ∫¶ (L) „ÅØ100%ÔºàÁôΩÔºâ„Åã„Çâ50%ÔºàÁ¥îÁ≤ã„Å™Ëµ§Ôºâ„Å´Ê∏õÂ∞ë„ÄÇ
            const h = 0;
            const s = normalized * 100; // ÂΩ©Â∫¶„Åå0„Åã„Çâ100„Å´Â¢óÂä†
            const l = 100 - (normalized * 50); // ÊòéÂ∫¶„Åå100„Åã„Çâ50„Å´Ê∏õÂ∞ë

            return `hsl(${h}, ${s}%, ${l}%)`;
        }

        /**
         * Èü≥Èáè„É¨„Éô„É´„Å´Âü∫„Å•„ÅÑ„Å¶„Çπ„Éî„Éº„Ç´„Éº„Ç¢„Ç§„Ç≥„É≥„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô„ÄÇ
         * @param {number} volume - ÁèæÂú®„ÅÆÈü≥Èáè (0-1)„ÄÇ
         * @param {boolean} isMuted - ÁèæÂú®„Éü„É•„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÄÇ
         */
        function updateSpeakerIcon(volume, isMuted) {
            let pathD;
            if (isMuted || volume === 0) {
                // Èü≥Èáè„Ç™„Éï„Ç¢„Ç§„Ç≥„É≥
                pathD = "M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C19.56 15.34 20 13.73 20 12c0-3.28-2.11-6.04-5-6.81v2.06c2.22.82 3.79 3.02 3.79 5.09zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.27 4.27L16 21.73l1.73-1.73L21.73 21 23 19.73 4.27 3zM12 4L9.17 7H5v4h3.17l3.83 3.83V4z";
            } else if (volume > 0 && volume <= 0.5) {
                // Èü≥ÈáèÂ∞è„Ç¢„Ç§„Ç≥„É≥ (‰ΩéÈü≥Èáè)
                pathD = "M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z";
            } else {
                // Èü≥ÈáèÂ§ß„Ç¢„Ç§„Ç≥„É≥ (‰∏≠/È´òÈü≥Èáè)
                pathD = "M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zM3 9v6h4l5 5V4L7 9H3z";
            }
            speakerIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="${pathD}"/></svg>`;
        }

        // --- IndexedDBÈñ¢Êï∞ ---

        /**
         * IndexedDB„Éá„Éº„Çø„Éô„Éº„Çπ„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åô„ÄÇ
         * „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çπ„Éà„Ç¢„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ
         */
        function initDb() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME);
                    }
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('IndexedDB„ÅåÊ≠£Â∏∏„Å´ÂàùÊúüÂåñ„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                    resolve();
                };

                request.onerror = (event) => {
                    console.error('IndexedDB„Ç®„É©„Éº:', event.target.errorCode);
                    reject(event.target.errorCode);
                };
            });
        }

        /**
         * ÁèæÂú®„ÅÆ„Ç≤„Éº„É†Áä∂ÊÖã„ÇíIndexedDB„Å´‰øùÂ≠ò„Åó„Åæ„Åô„ÄÇ
         */
        async function saveGame() {
            if (!db) {
                console.error("IndexedDB„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ‰øùÂ≠ò„Åß„Åç„Åæ„Åõ„Çì„ÄÇ");
                return;
            }
            // ‰øùÂ≠òÂâç„Å´lastPlayedTime„ÇíÊõ¥Êñ∞
            gameState.lastPlayedTime = Date.now();
            // ÁèæÂú®„ÅÆÈü≥Èáè„Çí‰øùÂ≠ò
            gameState.volume = audioElement.volume;
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.put(gameState, 'gameData'); // Âõ∫ÂÆö„Ç≠„Éº'gameData'„Çí‰ΩøÁî®

            request.onsuccess = () => {
                // console.log('„Ç≤„Éº„É†„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
            };

            request.onerror = (event) => {
                console.error('„Ç≤„Éº„É†„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:', event.target.errorCode);
            };
        }

        /**
         * IndexedDB„Åã„Çâ„Ç≤„Éº„É†Áä∂ÊÖã„Çí„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ
         * „Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÄÅÂàùÊúü„Ç≤„Éº„É†Áä∂ÊÖã„ÇíËøî„Åó„Åæ„Åô„ÄÇ
         */
        async function loadGame() {
            if (!db) {
                console.error("IndexedDB„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„É≠„Éº„Éâ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ");
                return;
            }
            return new Promise((resolve) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.get('gameData');

                request.onsuccess = (event) => {
                    let loadedState = event.target.result;
                    if (loadedState) {
                        // „É≠„Éº„Éâ„Åï„Çå„ÅüÁä∂ÊÖã„Çí„Éá„Éï„Ç©„É´„Éà„Å®„Éû„Éº„Ç∏„Åó„Å¶„ÄÅÊñ∞„Åó„ÅÑ„Éó„É≠„Éë„ÉÜ„Ç£„ÅåÂ≠òÂú®„Åô„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô
                        // „Åì„Çå„Å´„Çà„Çä„ÄÅÊñ∞„Åó„ÅÑ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÇÑ„Éó„É≠„Éë„ÉÜ„Ç£„ÅågameState„Å´ËøΩÂä†„Åï„Çå„Åü„Åå„ÄÅ
                        // Âè§„ÅÑ‰øùÂ≠ò„Éá„Éº„Çø„Å´„ÅØÂ≠òÂú®„Åó„Å™„ÅÑ„Ç±„Éº„Çπ„ÅåÂá¶ÁêÜ„Åï„Çå„Åæ„Åô„ÄÇ
                        gameState.energy = loadedState.energy || 0;
                        gameState.clickPower = loadedState.clickPower || 1;
                        gameState.autoClickPower = loadedState.autoClickPower || 0;
                        gameState.strongStartLevel = loadedState.strongStartLevel || 0;
                        gameState.lastPlayedTime = loadedState.lastPlayedTime || Date.now();
                        gameState.heatClickMultiplier = loadedState.heatClickMultiplier || 1.0;
                        gameState.lastClickTime = loadedState.lastClickTime || Date.now();
                        gameState.volume = loadedState.volume !== undefined ? loadedState.volume : 0.5; // Èü≥Èáè„Çí„É≠„Éº„Éâ„ÄÅÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ0.5„Çí„Éá„Éï„Ç©„É´„Éà
                        gameState.inventory = loadedState.inventory || {}; // „Ç§„É≥„Éô„É≥„Éà„É™„Çí„É≠„Éº„Éâ„ÄÅÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí„Éá„Éï„Ç©„É´„Éà
                        gameState.planetExcavationCooldowns = loadedState.planetExcavationCooldowns || {}; // „ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„Çí„É≠„Éº„Éâ
                        gameState.selectedBatchAmount = loadedState.selectedBatchAmount || 1; // „Éê„ÉÉ„ÉÅË≥ºÂÖ•Èáè„Çí„É≠„Éº„Éâ

                        // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„É≠„Éº„Éâ„Å®Êñ∞„Åó„ÅÑ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆËøΩÂä†
                        // Êñ∞„Åó„ÅÑ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåËøΩÂä†„Åï„Çå„ÅüÂ†¥Âêà„Å´ gameState.upgrades „ÅåÊó¢Â≠ò„ÅÆ„Ç≠„Éº„Çí‰øùÊåÅ„Åó„ÄÅ
                        // Âè§„ÅÑ‰øùÂ≠ò„Éá„Éº„Çø„Å´„Å™„ÅÑ„Éó„É≠„Éë„ÉÜ„Ç£ (‰æã: type, targetUpgrade, maxLevel, icon, effect, unlocks) „Çí
                        // „Éá„Éï„Ç©„É´„ÉàÂÄ§„ÅßÂüã„ÇÅ„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô„ÄÇ
                        for (const key in gameState.upgrades) {
                            if (loadedState.upgrades && loadedState.upgrades[key]) {
                                // Êó¢Â≠ò„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅ‰øùÂ≠ò„Åï„Çå„Åü„É¨„Éô„É´„Å®„Ç≥„Çπ„Éà„Çí„É≠„Éº„Éâ
                                gameState.upgrades[key].level = loadedState.upgrades[key].level;
                                gameState.upgrades[key].cost = loadedState.upgrades[key].cost;
                                // „Åù„ÅÆ‰ªñ„ÅÆ„Éó„É≠„Éë„ÉÜ„Ç£„Çí„Éû„Éº„Ç∏ (Áâπ„Å´Êñ∞„Åó„ÅÑ„Éó„É≠„Éë„ÉÜ„Ç£„ÇÑÈôêÁïåÁ™ÅÁ†¥Èñ¢ÈÄ£)
                                Object.assign(gameState.upgrades[key], loadedState.upgrades[key]);
                            } else {
                                // Êñ∞„Åó„ÅÑ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåËøΩÂä†„Åï„Çå„ÅüÂ†¥Âêà„ÄÅ„Éá„Éï„Ç©„É´„Éà„Å´ÂàùÊúüÂåñ
                                // initialCost„Éó„É≠„Éë„ÉÜ„Ç£„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÄÅ„Åù„Çå„Çí‰ΩøÁî®„Åó„Å¶„Ç≥„Çπ„Éà„Çí„É™„Çª„ÉÉ„Éà
                                if (gameState.upgrades[key].initialCost) {
                                    gameState.upgrades[key].cost = gameState.upgrades[key].initialCost;
                                }
                                gameState.upgrades[key].level = 0;
                                if (gameState.upgrades[key].breakthroughLevel !== undefined) {
                                    gameState.upgrades[key].breakthroughLevel = 0;
                                }
                                // wideRangeTransfer„ÅÆunlockedPlanets„ÇÇÂàùÊúüÂåñ„ÇíÁ¢∫ÂÆü„Å´„Åô„Çã
                                if (key === 'wideRangeTransfer') {
                                    gameState.upgrades[key].unlockedPlanets = [];
                                }
                            }
                        }

                        // wideRangeTransfer„Å´„Çà„Å£„Å¶„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÊÉëÊòü„ÇígameState.upgrades„Å´ËøΩÂä†
                        // „É≠„Éº„Éâ„Åï„Çå„ÅüunlockedPlanets„Å´Âü∫„Å•„ÅÑ„Å¶ËøΩÂä†„Åô„Çã
                        if (gameState.upgrades.wideRangeTransfer && gameState.upgrades.wideRangeTransfer.unlockedPlanets) {
                            gameState.upgrades.wideRangeTransfer.unlockedPlanets.forEach(newPlanetKey => {
                                if (!(newPlanetKey in gameState.upgrades) && newPlanetsData[newPlanetKey]) {
                                    gameState.upgrades[newPlanetKey] = { ...newPlanetsData[newPlanetKey] };
                                }
                            });
                        }


                        // ÁÜ±„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÊúÄÂ§ßÂÄçÁéá„ÇíÈôêÁïåÁ™ÅÁ†¥„É¨„Éô„É´„Å´Âü∫„Å•„ÅÑ„Å¶Êõ¥Êñ∞
                        updateHeatClickerMaxMultiplier();
                        // ÈôêÁïåÁ™ÅÁ†¥„É°„Éã„É•„Éº„ÅÆË°®Á§∫„Çí„ÉÅ„Çß„ÉÉ„ÇØ (ÁèæÂú®„ÅØÁµ±Âêà„Åï„Çå„Å¶„ÅÑ„Çã„Åü„ÇÅ‰∏çË¶Å„Å†„Åå„ÄÅ„Ç≥„Éº„Éâ„Å®„Åó„Å¶„ÅØÊÆã„Åó„Å¶„Åä„Åè)
                        checkBreakthroughMenuVisibility();

                        // „Ç™„Éï„É©„Ç§„É≥„Åß„ÅÆÁç≤Âæó„ÇíÂá¶ÁêÜ
                        if (gameState.lastPlayedTime) {
                            const currentTime = Date.now();
                            let timeAway = currentTime - gameState.lastPlayedTime;
                            timeAway = Math.min(timeAway, MAX_INACTIVITY_MS); // 24ÊôÇÈñì„Åß‰∏äÈôêË®≠ÂÆö

                            const offlineEnergy = (gameState.autoClickPower / 1000) * timeAway; // autoClickPower„ÅØ1Áßí„ÅÇ„Åü„Çä
                            if (offlineEnergy > 0) {
                                gameState.energy += offlineEnergy;
                                // „Ç™„Éï„É©„Ç§„É≥„Ç®„Éç„É´„ÇÆ„Éº„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Éú„Çø„É≥ÂøúÁ≠î„Çí‰øÆÊ≠£
                                showGenericModal(confirmationModal, `„Ç™„Éï„É©„Ç§„É≥‰∏≠„Å´ ${formatNumber(offlineEnergy)} „Ç®„Éç„É´„ÇÆ„Éº„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`, () => hideModal(confirmationModal), null, 'OK', 'bg-green-600 hover:bg-green-700');
                                modalConfirmButton.style.display = 'block'; // OK„Éú„Çø„É≥„ÇíË°®Á§∫
                                modalCancelButton.style.display = 'none'; // Cancel„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
                            }
                        }
                        console.log('„Ç≤„Éº„É†„Åå„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                    } else {
                        console.log('‰øùÂ≠ò„Åï„Çå„Åü„Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÊñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÈñãÂßã„Åó„Åæ„Åô„ÄÇ');
                        // gameState„ÅØ„Åô„Åß„Å´ÂàùÊúüÁä∂ÊÖã„Å´„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åô
                        // Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÅÆÂ†¥Âêà„ÇÇÁÜ±„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÊúÄÂ§ßÂÄçÁéá„ÇíÂàùÊúüÂåñ
                        updateHeatClickerMaxMultiplier();
                    }
                    updateDisplay();
                    resolve();
                };

                request.onerror = (event) => {
                    console.error('„Ç≤„Éº„É†„ÅÆ„É≠„Éº„Éâ„Ç®„É©„Éº:', event.target.errorCode);
                    updateDisplay(); // „Ç®„É©„ÉºÁô∫ÁîüÊôÇ„Åß„ÇÇË°®Á§∫„ÇíÊõ¥Êñ∞
                    resolve(); // „É≠„Éº„Éâ„Å´Â§±Êïó„Åó„ÅüÂ†¥Âêà„Åß„ÇÇÁ∂öË°å„Åô„Çã„Åü„ÇÅ„Å´Ëß£Ê±∫
                };
            });
        }

        /**
         * IndexedDB„Åã„Çâ„Åô„Åπ„Å¶„ÅÆ„Ç≤„Éº„É†„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÄÇ
         */
        async function clearGameData() {
            if (!db) {
                console.error("IndexedDB„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åß„Åç„Åæ„Åõ„Çì„ÄÇ");
                return;
            }
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.clear();

                request.onsuccess = () => {
                    console.log('IndexedDB„Åã„Çâ„Ç≤„Éº„É†„Éá„Éº„Çø„Åå„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                    resolve();
                };

                request.onerror = (event) => {
                    console.error('„Ç≤„Éº„É†„Éá„Éº„Çø„ÅÆ„ÇØ„É™„Ç¢„Ç®„É©„Éº:', event.target.errorCode);
                    reject(event.target.errorCode);
                };
            });
        }

        // --- „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ ---

        /**
         * „Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÊúÄÂ§ßÂÄçÁéá„ÇíÈôêÁïåÁ™ÅÁ†¥„É¨„Éô„É´„Å´Âü∫„Å•„ÅÑ„Å¶Êõ¥Êñ∞„Åó„Åæ„Åô„ÄÇ
         */
        function updateHeatClickerMaxMultiplier() {
            const heatClickerBTLvl = gameState.upgrades.heatClickerBreakthrough.level;
            // heatClicker„ÅÆcurrentMaxMultiplier„Éó„É≠„Éë„ÉÜ„Ç£„ÇíÊõ¥Êñ∞
            gameState.upgrades.heatClicker.currentMaxMultiplier = 2.0 + (heatClickerBTLvl * gameState.upgrades.heatClickerBreakthrough.effect);
            // ÁèæÂú®„ÅÆheatClickMultiplier„ÅåÊñ∞„Åó„ÅÑÊúÄÂ§ßÂÄ§„ÇíË∂Ö„Åà„Å™„ÅÑ„Çà„ÅÜ„Å´Ë™øÊï¥
            gameState.heatClickMultiplier = Math.min(gameState.heatClickMultiplier, gameState.upgrades.heatClicker.currentMaxMultiplier);
        }

        /**
         * Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ„Éë„ÉØ„Éº„Å´Âü∫„Å•„ÅÑ„Å¶Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ„Åó„Åæ„Åô„ÄÇ
         */
        function autoClickLoop() {
            gameState.energy += gameState.autoClickPower / 10; // 100msÈñìÈöî„Å™„ÅÆ„Åß10„ÅßÂâ≤„Çã
            updateDisplay();
        }

        /**
         * Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÅÆ„Åü„ÇÅ„Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÂÄçÁéá„Çí„É™„Çª„ÉÉ„Éà„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Åã„Å©„ÅÜ„Åã„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ
         */
        function checkHeatClickerReset() {
            if (gameState.upgrades.heatClicker && gameState.upgrades.heatClicker.level > 0 &&
                gameState.heatClickMultiplier > 1.0 && // „Åô„Åß„Å´„Éñ„Éº„Çπ„Éà„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø„É™„Çª„ÉÉ„Éà
                Date.now() - gameState.lastClickTime >= HEAT_CLICKER_RESET_TIME_MS) {
                gameState.heatClickMultiplier = 1.0; // Âü∫Êú¨ÂÄçÁéá„Å´„É™„Çª„ÉÉ„Éà
                updateDisplay(); // „É™„Çª„ÉÉ„Éà„ÇíÂèçÊò†„Åô„Çã„Åü„ÇÅ„Å´Ë°®Á§∫„ÇíÊõ¥Êñ∞
            }
        }

        /**
         * „É°„Ç§„É≥„ÅÆÊé°Êéò„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥Ë°®Á§∫„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô„ÄÇ
         */
        function updateExcavationCooldownDisplay() {
            // This display wrapper only makes sense if there's a global cooldown,
            // but now cooldowns are per-planet.
            // For simplicity, let's just make this visible if the license is owned.
            if (gameState.upgrades.excavationLicense && gameState.upgrades.excavationLicense.level > 0) {
                 excavationCooldownDisplayWrapper.style.display = 'block';
                 excavationCooldownDisplay.textContent = 'ÂêÑÊÉëÊòü„ÇíÂèÇÁÖß'; // Changed text to reflect per-planet cooldown
                 excavationCooldownDisplay.style.color = '#cbd5e1'; // Neutral color
            } else {
                excavationCooldownDisplayWrapper.style.display = 'none';
            }
        }

        /**
         * ÂêÑÊÉëÊòü„ÅÆÊé°Êéò„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„Å®„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥Ë°®Á§∫„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô„ÄÇ
         */
        function updateExcavationPlanetButtons() {
            if (!excavationModal.classList.contains('open')) return; // „É¢„Éº„ÉÄ„É´„ÅåÈñã„ÅÑ„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÊõ¥Êñ∞„Åó„Å™„ÅÑ

            // wideRangeTransfer„Åß„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÊÉëÊòü„ÇÇÂê´„ÇÅ„Å¶ÂÖ®„Å¶„ÅÆÊÉëÊòü„Çí„É´„Éº„Éó
            const allPlanetKeys = Object.keys(gameState.upgrades).filter(key =>
                gameState.upgrades[key].icon && gameState.upgrades[key].excavationCooldown
            );

            for (const planetKey of allPlanetKeys) {
                const planet = gameState.upgrades[planetKey];
                const button = document.querySelector(`#excavate-${planetKey}-button`);
                const cooldownBar = document.querySelector(`#cooldown-bar-${planetKey}`);
                const cooldownText = document.querySelector(`#cooldown-text-${planetKey}`);

                if (!button || !cooldownBar || !cooldownText) continue;

                const lastExcavated = gameState.planetExcavationCooldowns[planetKey] || 0;
                const planetCooldown = planet.excavationCooldown; // ÊÉëÊòüÂõ∫Êúâ„ÅÆ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„ÇíÂèñÂæó
                const timeElapsed = Date.now() - lastExcavated;
                const remainingTime = planetCooldown - timeElapsed;

                if (planet.level < EXCAVATION_MIN_PLANET_LEVEL) {
                    button.disabled = true;
                    button.textContent = `„É¨„Éô„É´ ${planet.level}/${EXCAVATION_MIN_PLANET_LEVEL} ÂøÖË¶Å`;
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-gray-500');
                    cooldownBar.style.width = '0%';
                    cooldownText.textContent = '';
                } else if (remainingTime > 0) {
                    button.disabled = true;
                    button.textContent = `„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥‰∏≠`;
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-gray-500');
                    const progress = (timeElapsed / planetCooldown) * 100;
                    cooldownBar.style.width = `${progress}%`;
                    cooldownText.textContent = `ÊÆã„Çä: ${formatTime(remainingTime)}`;
                } else {
                    button.disabled = false;
                    button.textContent = `Êé°Êéò`;
                    button.classList.remove('bg-gray-500');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    cooldownBar.style.width = '100%';
                    cooldownText.textContent = 'Ê∫ñÂÇôÂÆå‰∫Ü';
                }
            }
        }


        /**
         * Updates the display elements with current game state.
         */
        function updateDisplay() {
            energyDisplay.textContent = formatNumber(gameState.energy);
            clickPowerDisplay.textContent = formatNumber(gameState.clickPower);
            autoClickDisplay.textContent = formatNumber(gameState.autoClickPower);
            
            // Update heat clicker display visibility and value
            if (gameState.upgrades.heatClicker && gameState.upgrades.heatClicker.level > 0) {
                heatClickerDisplayWrapper.style.display = 'block';
                heatMultiplierDisplay.textContent = `${gameState.heatClickMultiplier.toFixed(1)}x`;
                heatMultiplierDisplay.style.color = getHeatColor(gameState.heatClickMultiplier);
            } else {
                heatClickerDisplayWrapper.style.display = 'none';
            }

            // Update excavation menu link visibility
            if (gameState.upgrades.excavationLicense && gameState.upgrades.excavationLicense.level > 0) {
                excavationMenuLink.style.display = 'block';
            } else {
                excavationMenuLink.style.display = 'none';
            }

            updateExcavationCooldownDisplay();
            // updateExcavationPlanetButtons(); // This is called in a separate interval now for smoother animation
            saveGame(); // Save game state whenever display is updated (implies state change)
        }

        /**
         * Handles the star click event.
         */
        function clickStar() {
            // Ensure music starts playing on first interaction if not already playing
            if (audioElement.paused) {
                audioElement.play().catch(e => console.error("Autoplay failed:", e));
            }

            // Apply heat clicker bonus first if active
            if (gameState.upgrades.heatClicker && gameState.upgrades.heatClicker.level > 0) {
                const currentTime = Date.now();
                if (currentTime - gameState.lastClickTime < HEAT_CLICKER_RESET_TIME_MS) {
                    gameState.heatClickMultiplier = Math.min(gameState.upgrades.heatClicker.currentMaxMultiplier, gameState.heatClickMultiplier + HEAT_CLICKER_INCREMENT);
                } else {
                    // Reset and start with first increment
                    gameState.heatClickMultiplier = Math.min(gameState.upgrades.heatClicker.currentMaxMultiplier, 1.0 + HEAT_CLICKER_INCREMENT);
                }
                gameState.lastClickTime = currentTime;
                // Add base click power, then the bonus from multiplier
                gameState.energy += gameState.clickPower * gameState.heatClickMultiplier;
            } else {
                gameState.energy += gameState.clickPower; // Normal click power
                gameState.heatClickMultiplier = 1.0; // Ensure reset if not active
            }
            updateDisplay();
        }

        /**
         * Calculates the cost and effects for purchasing a batch of upgrades.
         * @param {string} upgradeKey - The key of the upgrade to calculate for.
         * @param {number | 'max'} amount - The number of levels to simulate purchase for, or 'max'.
         * @returns {{totalEnergyCost: number, totalItemCost: object, levelsBought: number, totalClickBonus: number, totalAutoBonus: number, breakthroughLevelsBought: number}}
         */
        function calculateBatchCostAndEffects(upgradeKey, amount) {
            const upgrade = gameState.upgrades[upgradeKey];
            let simulatedCost = upgrade.cost;
            let simulatedLevel = upgrade.level;
            let totalEnergyCost = 0;
            let totalItemCost = {}; // „Ç¢„Ç§„ÉÜ„É†„Ç≥„Çπ„Éà„ÇíËøΩË∑°
            let levelsBought = 0;
            let totalClickBonus = 0;
            let totalAutoBonus = 0;
            let breakthroughLevelsBought = 0;

            // ÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆÂ†¥Âêà„ÅÆÁâπÊÆäÂá¶ÁêÜ
            if (upgrade.type === 'breakthrough') { // 'type'„Éó„É≠„Éë„ÉÜ„Ç£„ÅßÂà§ÂÆö
                if (upgrade.level >= upgrade.maxLevel) {
                    return { totalEnergyCost: 0, totalItemCost: {}, levelsBought: 0, totalClickBonus: 0, totalAutoBonus: 0, breakthroughLevelsBought: 0 };
                }
                // ÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅØ1„É¨„Éô„É´„Åö„Å§„Åó„ÅãË≥ºÂÖ•„Åß„Åç„Å™„ÅÑ„Å®‰ªÆÂÆö
                amount = 1; // Â∏∏„Å´1„É¨„Éô„É´Ë≥ºÂÖ• (maxÈÅ∏ÊäûÊôÇ„ÇÇ)

                // „Ç®„Éç„É´„ÇÆ„Éº„Ç≥„Çπ„Éà„ÅÆÁ¢∫Ë™ç
                if (gameState.energy < simulatedCost) {
                    return { totalEnergyCost: 0, totalItemCost: {}, levelsBought: 0, totalClickBonus: 0, totalAutoBonus: 0, breakthroughLevelsBought: 0 };
                }

                // „Ç¢„Ç§„ÉÜ„É†„Ç≥„Çπ„Éà„ÅÆÁ¢∫Ë™ç
                let canAffordItems = true;
                if (upgrade.itemCost) {
                    for (const itemKey in upgrade.itemCost) {
                        if ((gameState.inventory[itemKey] || 0) < upgrade.itemCost[itemKey]) {
                            canAffordItems = false;
                            break;
                        }
                    }
                }
                if (!canAffordItems) {
                    return { totalEnergyCost: 0, totalItemCost: {}, levelsBought: 0, totalClickBonus: 0, totalAutoBonus: 0, breakthroughLevelsBought: 0 };
                }

                totalEnergyCost += simulatedCost;
                if (upgrade.itemCost) {
                    for (const itemKey in upgrade.itemCost) {
                        totalItemCost[itemKey] = (totalItemCost[itemKey] || 0) + upgrade.itemCost[itemKey];
                    }
                }
                breakthroughLevelsBought = 1;
                levelsBought = 1; // ÈôêÁïåÁ™ÅÁ†¥„ÇÇ‰∏ÄÁ®Æ„ÅÆ„É¨„Éô„É´„Ç¢„ÉÉ„Éó„Å®„Åó„Å¶„Ç´„Ç¶„É≥„Éà

                return { totalEnergyCost, totalItemCost, levelsBought, totalClickBonus, totalAutoBonus, breakthroughLevelsBought };
            }

            // ÈÄöÂ∏∏„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆÂ†¥Âêà
            if (upgrade.maxLevel === 1 && upgrade.level >= 1) {
                return { totalEnergyCost: 0, totalItemCost: {}, levelsBought: 0, totalClickBonus: 0, totalAutoBonus: 0, breakthroughLevelsBought: 0 }; // Already purchased one-time upgrade
            }

            let limit = amount;
            if (amount === 'max') {
                limit = Infinity; // Try to buy as many as possible
            }

            for (let i = 0; i < limit; i++) {
                if (upgrade.maxLevel === 1 && simulatedLevel >= 1) break;

                // ÊúÄÂ§ßÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Åù„ÅÆ„É¨„Éô„É´„ÇíË∂Ö„Åà„Å¶Ë≥ºÂÖ•„Åó„Çà„ÅÜ„Å®„Åó„Å™„ÅÑ
                if (upgrade.maxLevel && simulatedLevel >= upgrade.maxLevel) {
                    break;
                }

                if (gameState.energy >= (totalEnergyCost + simulatedCost)) {
                    totalEnergyCost += simulatedCost;
                    totalClickBonus += upgrade.clickBonus;
                    totalAutoBonus += upgrade.autoBonus;
                    levelsBought++;
                    simulatedLevel++;
                    if (upgrade.maxLevel !== 1) { // Only increase cost if not a one-time upgrade
                        simulatedCost = Math.floor(simulatedCost * 1.5); // Calculate next level's cost
                    }
                } else {
                    break; // Cannot afford next level
                }
            }
            return { totalEnergyCost, totalItemCost, levelsBought, totalClickBonus, totalAutoBonus, breakthroughLevelsBought };
        }


        /**
         * Handles the purchase of an upgrade (single or batch).
         * @param {string} upgradeKey - The key of the upgrade to purchase.
         * @param {number | 'max'} amount - The number of levels to buy, or 'max'.
         */
        function buyUpgradeLogic(upgradeKey, amount) {
            const upgrade = gameState.upgrades[upgradeKey];

            // For one-time upgrades, if already purchased, do nothing.
            if (upgrade.maxLevel === 1 && upgrade.level >= 1 && upgrade.type !== 'breakthrough') {
                console.log("This upgrade can only be purchased once.");
                return;
            }

            const { totalEnergyCost, totalItemCost, levelsBought, totalClickBonus, totalAutoBonus, breakthroughLevelsBought } = calculateBatchCostAndEffects(upgradeKey, amount);

            if (levelsBought > 0) {
                // „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª
                gameState.energy -= totalEnergyCost;

                // „Ç¢„Ç§„ÉÜ„É†Ê∂àË≤ª
                for (const itemKey in totalItemCost) {
                    gameState.inventory[itemKey] -= totalItemCost[itemKey];
                }

                gameState.clickPower += totalClickBonus;
                gameState.autoClickPower += totalAutoBonus;
                upgrade.level += levelsBought;

                // ÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆÂ†¥Âêà„ÅÆÁâπÊÆä„Å™ÂäπÊûú
                if (upgrade.type === 'breakthrough' && upgrade.targetUpgrade) {
                    const targetUpgrade = gameState.upgrades[upgrade.targetUpgrade];
                    if (targetUpgrade) {
                        targetUpgrade.breakthroughLevel = (targetUpgrade.breakthroughLevel || 0) + breakthroughLevelsBought;
                        // ÁÜ±„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÊúÄÂ§ßÂÄçÁéá„ÇíÊõ¥Êñ∞
                        if (upgrade.targetUpgrade === 'heatClicker') {
                            updateHeatClickerMaxMultiplier();
                        }
                        // Â∫ÉÁØÑÂõ≤Ëª¢ÈÄÅË£ÖÁΩÆ„ÅßÊñ∞„Åó„ÅÑÊÉëÊòü„Çí„Ç¢„É≥„É≠„ÉÉ„ÇØ
                        if (upgrade.targetUpgrade === 'wideRangeTransfer' && upgrade.unlocks) {
                            upgrade.unlocks.slice(0, targetUpgrade.breakthroughLevel).forEach(newPlanetKey => {
                                if (!(newPlanetKey in gameState.upgrades) && newPlanetsData[newPlanetKey]) { // ÈáçË§áËøΩÂä†„ÇíÈò≤„Åê
                                    gameState.upgrades[newPlanetKey] = { ...newPlanetsData[newPlanetKey] };
                                    // wideRangeTransfer„ÅÆunlockedPlanets„Å´Êñ∞„Åó„ÅÑÊÉëÊòü„ÇíËøΩÂä†
                                    if (!targetUpgrade.unlockedPlanets.includes(newPlanetKey)) {
                                        targetUpgrade.unlockedPlanets.push(newPlanetKey);
                                    }
                                }
                            });
                        }
                    }
                }


                if (upgrade.maxLevel !== 1 && upgrade.type !== 'breakthrough') { // ÈÄöÂ∏∏„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„Åø„Ç≥„Çπ„Éà„ÇíÂ¢óÂä†„Åï„Åõ„Çã
                    // Recalculate the cost for the *next* level after the batch purchase
                    upgrade.cost = Math.floor(upgrade.cost * Math.pow(1.5, levelsBought));
                }

                updateDisplay();
                renderUpgrades(); // Re-render upgrades after purchase to update button states
                renderInventory(); // „Ç§„É≥„Éô„É≥„Éà„É™„ÇíÊõ¥Êñ∞
                renderExcavationPlanets(); // Êñ∞„Åó„ÅÑÊÉëÊòü„Åå„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„Åü„ÇÅÊõ¥Êñ∞
                // If excavationLicense is purchased, update the menu link visibility
                if (upgradeKey === 'excavationLicense') {
                    excavationMenuLink.style.display = 'block';
                }
                // checkBreakthroughMenuVisibility(); // This is no longer needed as breakthrough link is always hidden
            } else {
                console.log("Not enough resources to buy any levels of " + upgradeKey);
            }
        }


        /**
         * Renders the upgrade items in the upgrades section.
         */
        function renderUpgrades() {
            // Store current scroll position before clearing
            const upgradesSidebarContent = upgradesSidebarModal.querySelector('.upgrades-sidebar-content');
            const upgradesScrollTop = upgradesSidebarContent ? upgradesSidebarContent.scrollTop : 0; // Check if element exists

            regularUpgradeList.innerHTML = ''; // Clear previous regular upgrades
            oneTimeUpgradeList.innerHTML = ''; // Clear previous one-time upgrades
            // breakthroughUpgradeList.innerHTML = ''; // Not used directly anymore

            // Hide breakthrough section headers and menu link as breakthroughs are integrated
            if (breakthroughUpgradesSectionHeader) breakthroughUpgradesSectionHeader.style.display = 'none';
            if (breakthroughMenuLink) breakthroughMenuLink.style.display = 'none';


            // Define a fixed order for regular planet upgrades
            const fixedRegularOrder = [
                'mercury', 'venus', 'earth', 'mars', 'jupiter', 'saturn', 'uranus', 'neptune', 'originalPlanetX',
                'cometA', 'dwarfPlanet', 'gasGiantMoon' // Add new planets to fixed order
            ];

            // Define a fixed order for one-time upgrades
            const fixedOneTimeOrder = [
                'cosmicDrill', 'galacticReactor', 'excavationLicense', 'heatClicker', 'wideRangeTransfer'
            ];

            // Collect all breakthrough upgrades for easy lookup
            const breakthroughUpgradesMap = {};
            for (const key in gameState.upgrades) {
                const upgrade = gameState.upgrades[key];
                if (upgrade.type === 'breakthrough') {
                    if (upgrade.targetUpgrade) {
                        if (!breakthroughUpgradesMap[upgrade.targetUpgrade]) {
                            breakthroughUpgradesMap[upgrade.targetUpgrade] = [];
                        }
                        breakthroughUpgradesMap[upgrade.targetUpgrade].push(key);
                    }
                }
            }

            // Sort breakthrough upgrades within their target groups by cost
            for (const targetKey in breakthroughUpgradesMap) {
                breakthroughUpgradesMap[targetKey].sort((a, b) => gameState.upgrades[a].cost - gameState.upgrades[b].cost);
            }

            // Render Regular Upgrades + their breakthroughs
            fixedRegularOrder.forEach(key => {
                const upgrade = gameState.upgrades[key];
                // Ensure the upgrade exists and is a regular planet upgrade (no 'type' and no 'maxLevel')
                if (upgrade && !upgrade.type && upgrade.maxLevel === undefined) {
                    const upgradeElement = createUpgradeElement(key, upgrade, breakthroughUpgradesMap[key]);
                    if (upgradeElement) regularUpgradeList.appendChild(upgradeElement);
                }
            });

            // Render One-Time Upgrades + their breakthroughs
            fixedOneTimeOrder.forEach(key => {
                const upgrade = gameState.upgrades[key];
                // Ensure the upgrade exists and is a one-time upgrade (maxLevel is 1, and not a breakthrough type)
                // Only render if not yet purchased, or if it's heatClicker/wideRangeTransfer (which might have associated breakthroughs)
                if (upgrade && upgrade.maxLevel === 1 && upgrade.type !== 'breakthrough') {
                    // Only render if the main upgrade itself has level 0 OR if it has associated breakthroughs
                    // This covers cases where we want to show heatClicker/wideRangeTransfer even if level 0
                    // because their breakthroughs might become available later.
                    // The breakthrough section itself will be hidden if upgrade.level is 0.
                    const upgradeElement = createUpgradeElement(key, upgrade, breakthroughUpgradesMap[key]);
                    if (upgradeElement) oneTimeUpgradeList.appendChild(upgradeElement);
                }
            });

            // Restore scroll position after rendering
            // Added a small delay to ensure DOM is rendered before attempting to scroll
            if (upgradesSidebarContent) {
                setTimeout(() => {
                    upgradesSidebarContent.scrollTop = upgradesScrollTop;
                }, 50); // Small delay
            }
        }

        // Helper function to create an individual upgrade element
        function createUpgradeElement(key, upgrade, associatedBreakthroughKeys = []) {
            const upgradeElement = document.createElement('div');
            upgradeElement.className = 'upgrade-item';

            let upgradeStatusText = '';
            let isPurchasedOneTime = (upgrade.maxLevel === 1 && upgrade.level >= 1 && upgrade.type !== 'breakthrough');
            let purchaseButtonText = 'Ë≥ºÂÖ•';

            if (isPurchasedOneTime) {
                upgradeStatusText = `<p class="text-sm text-green-400 font-bold">Ë≥ºÂÖ•Ê∏à„Åø</p>`;
                purchaseButtonText = 'ÂÆå‰∫Ü';
            } else if (upgrade.type === 'breakthrough' && upgrade.level >= upgrade.maxLevel) {
                upgradeStatusText = `<p class="text-sm text-green-400 font-bold">ÊúÄÂ§ß„É¨„Éô„É´</p>`;
                purchaseButtonText = 'ÂÆå‰∫Ü';
            }
            else {
                const { totalEnergyCost, totalItemCost, levelsBought } = calculateBatchCostAndEffects(key, gameState.selectedBatchAmount);

                if (levelsBought === 0) {
                     purchaseButtonText = '‰∏çË∂≥';
                } else if (gameState.selectedBatchAmount === 'max') {
                    purchaseButtonText = `Ë≥ºÂÖ• (Max)`;
                }
                else {
                    purchaseButtonText = `Ë≥ºÂÖ• (x${levelsBought})`;
                }

                // Display cost for the main upgrade
                let costDetails = `<p class="text-lg font-bold mb-2">„Ç®„Éç„É´„ÇÆ„Éº: ${formatNumber(upgrade.cost)}</p>`;
                if (upgrade.itemCost) {
                    for (const itemKey in upgrade.itemCost) {
                        const item = itemData[itemKey] || { name: itemKey, icon: '‚ùì' };
                        costDetails += `<p class="text-sm text-gray-400">${item.icon} ${item.name}: ${formatNumber(upgrade.itemCost[itemKey])}</p>`;
                    }
                }
                upgradeStatusText = costDetails;
            }

            let breakthroughSection = '';
            // Only render breakthrough section if there are associated breakthroughs AND the main upgrade has been purchased (level > 0)
            if (associatedBreakthroughKeys.length > 0 && upgrade.level > 0) { // Changed condition here
                breakthroughSection += `<div class="mt-4 pt-4 border-t border-gray-600 w-full">
                                    <h4 class="text-md font-semibold text-purple-400 mb-2">ÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ:</h4>`;
                associatedBreakthroughKeys.forEach(btKey => {
                    const btUpgrade = gameState.upgrades[btKey];
                    if (!btUpgrade) return; // Skip if breakthrough upgrade not found

                    let btPurchaseButtonText = 'Ë≥ºÂÖ•';
                    let btCanAfford = true;
                    const { totalEnergyCost, totalItemCost, levelsBought } = calculateBatchCostAndEffects(btKey, 1); // Breakthroughs are always x1

                    if (btUpgrade.level >= btUpgrade.maxLevel) {
                        btPurchaseButtonText = 'ÊúÄÂ§ß„É¨„Éô„É´';
                        btCanAfford = false;
                    } else if (levelsBought === 0) {
                        btPurchaseButtonText = '‰∏çË∂≥';
                        btCanAfford = false;
                    }

                    let btCostDetails = `<p class="text-sm font-bold mt-1">„Ç®„Éç„É´„ÇÆ„Éº: ${formatNumber(btUpgrade.cost)}</p>`;
                    if (btUpgrade.itemCost) {
                        for (const itemKey in btUpgrade.itemCost) {
                            const item = itemData[itemKey] || { name: itemKey, icon: '‚ùì' };
                            btCostDetails += `<p class="text-xs text-gray-500">${item.icon} ${item.name}: ${formatNumber(btUpgrade.itemCost[itemKey])}</p>`;
                        }
                    }

                    // Apply red color to breakthrough buttons
                    const buttonClasses = btCanAfford ? 'bg-red-600 hover:bg-red-700' : 'bg-gray-500';

                    breakthroughSection += `
                        <div class="flex items-center justify-between mt-2 p-3 bg-gray-700 rounded-lg">
                            <div>
                                <p class="text-base font-medium">${btUpgrade.icon} ${btKey.charAt(0).toUpperCase() + btKey.slice(1).replace(/([A-Z])/g, ' $1').trim()}</p>
                                <p class="text-sm text-gray-400">„É¨„Éô„É´: ${btUpgrade.level}/${btUpgrade.maxLevel}</p>
                                ${btUpgrade.targetUpgrade === 'heatClicker' ? `<p class="text-sm text-gray-400">ÂäπÊûú: ÊúÄÂ§ßÂÄçÁéá +${(btUpgrade.effect * 100).toFixed(0)}%</p>` : ''}
                                ${btUpgrade.targetUpgrade === 'wideRangeTransfer' ? `<p class="text-sm text-gray-400">ÂäπÊûú: Êñ∞„Åó„ÅÑÊÉëÊòü„Çí„Ç¢„É≥„É≠„ÉÉ„ÇØ</p>` : ''}
                                ${btCostDetails}
                            </div>
                            <button data-upgrade="${btKey}" class="buy-upgrade px-4 py-2 rounded-lg font-semibold transition duration-200 ${buttonClasses}" ${!btCanAfford ? 'disabled' : ''}>
                                ${btPurchaseButtonText}
                            </button>
                        </div>
                    `;
                });
                breakthroughSection += `</div>`;
            }


            upgradeElement.innerHTML = `
                <div class="flex items-center upgrade-info">
                    <span class="upgrade-icon">${upgrade.icon}</span>
                    <div>
                        <h3 class="text-xl font-semibold">${key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1').trim()}</h3>
                        <p class="text-sm text-gray-400">„É¨„Éô„É´: ${upgrade.level}</p>
                        ${upgrade.clickBonus > 0 ? `<p class="text-sm text-gray-400">„ÇØ„É™„ÉÉ„ÇØ„Éë„ÉØ„Éº +${formatNumber(upgrade.clickBonus)}</p>` : ''}
                        ${upgrade.autoBonus > 0 ? `<p class="text-sm text-gray-400">Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ +${formatNumber(upgrade.autoBonus)}/Áßí</p>` : ''}
                    </div>
                </div>
                <div class="upgrade-actions">
                    ${upgradeStatusText}
                    <button data-upgrade="${key}" class="buy-upgrade px-5 py-2 rounded-lg font-semibold transition duration-200">
                        ${purchaseButtonText}
                    </button>
                </div>
                ${breakthroughSection} <!-- Insert breakthrough upgrades here -->
            `;

            // Re-attach event listeners for all new buy-upgrade buttons (both main and breakthrough)
            upgradeElement.querySelectorAll('.buy-upgrade').forEach(button => {
                const btnUpgradeKey = button.dataset.upgrade;
                // For main upgrade buttons, use gameState.selectedBatchAmount
                // For breakthrough upgrade buttons, always use 1 (as per previous logic)
                const amountToBuy = gameState.upgrades[btnUpgradeKey].type === 'breakthrough' ? 1 : gameState.selectedBatchAmount;
                button.addEventListener('click', () => buyUpgradeLogic(btnUpgradeKey, amountToBuy));
            });

            const buyButton = upgradeElement.querySelector(`.upgrade-actions > button[data-upgrade="${key}"]`); // Get the main upgrade button

            const { totalEnergyCost, totalItemCost, levelsBought } = calculateBatchCostAndEffects(key, gameState.selectedBatchAmount);

            let canAfford = true;
            if (totalEnergyCost > gameState.energy) canAfford = false;
            for (const itemKey in totalItemCost) {
                if ((gameState.inventory[itemKey] || 0) < totalItemCost[itemKey]) {
                    canAfford = false;
                    break;
                }
            }

            if (isPurchasedOneTime) { // One-time upgrades that are already purchased
                canAfford = false;
            }

            if (!canAfford || levelsBought === 0) {
                if (buyButton) { // Ensure the button exists before trying to modify its properties
                    buyButton.disabled = true;
                    buyButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    buyButton.classList.add('bg-gray-500'); // Apply disabled style
                }
            } else {
                if (buyButton) {
                    buyButton.disabled = false;
                    buyButton.classList.remove('bg-gray-500'); // Ensure disabled style is removed
                    buyButton.classList.add('bg-blue-600', 'hover:bg-blue-700'); // Apply active styles
                }
            }
            return upgradeElement;
        }


        /**
         * „Ç§„É≥„Éô„É≥„Éà„É™ÂÜÖ„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åó„Åæ„Åô„ÄÇ
         */
        function renderInventory() {
            inventoryContent.innerHTML = ''; // ‰ª•Ââç„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí„ÇØ„É™„Ç¢
            const hasItems = Object.keys(gameState.inventory).some(key => gameState.inventory[key] > 0);

            if (!hasItems) {
                inventoryContent.innerHTML = '<p class="text-center text-gray-400">„Ç§„É≥„Éô„É≥„Éà„É™„ÅØÁ©∫„Åß„Åô„ÄÇ</p>';
                return;
            }

            for (const itemKey in itemData) { // ÂÆöÁæ©„Åï„Çå„Åü„Ç¢„Ç§„ÉÜ„É†„ÅÆ„ÅøË°®Á§∫
                if (gameState.inventory[itemKey] && gameState.inventory[itemKey] > 0) {
                    const item = itemData[itemKey];
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item flex justify-between items-center';
                    itemElement.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">${item.icon}</span>
                            <p class="text-lg font-semibold">${item.name}</p>
                        </div>
                        <p class="text-xl font-bold">${formatNumber(gameState.inventory[itemKey])}</p>
                    `;
                    inventoryContent.appendChild(itemElement);
                }
            }
        }

        /**
         * Êé°Êéò„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÊÉëÊòü„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åó„Åæ„Åô„ÄÇ
         */
        function renderExcavationPlanets() {
            excavationPlanetList.innerHTML = ''; // ‰ª•Ââç„ÅÆÊÉëÊòü„Çí„ÇØ„É™„Ç¢

            // gameState.upgradesÂÜÖ„ÅÆÈÄöÂ∏∏„ÅÆÊÉëÊòü„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Å®wideRangeTransfer„Åß„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÊÉëÊòü„Çí„É™„Çπ„Éà„Ç¢„ÉÉ„Éó
            const allPlanetKeys = Object.keys(gameState.upgrades).filter(key =>
                gameState.upgrades[key].icon && gameState.upgrades[key].excavationCooldown
            );

            // „Ç≥„Çπ„Éà„Åß„ÇΩ„Éº„ÉàÔºà„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„ÅÆÈ†ÜÂ∫è„Å®Âêå„Åò„Å´„Å™„Çã„Åü„ÇÅÔºâ
            allPlanetKeys.sort((a, b) => gameState.upgrades[a].cost - gameState.upgrades[b].cost);


            if (allPlanetKeys.length === 0) {
                excavationPlanetList.innerHTML = '<p class="text-center text-gray-400">Êé°ÊéòÂèØËÉΩ„Å™ÊÉëÊòü„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }

            allPlanetKeys.forEach(key => {
                const planet = gameState.upgrades[key];
                const planetName = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1').trim(); // „Ç≠„É£„É°„É´„Ç±„Éº„Çπ„Çí„Çπ„Éö„Éº„ÇπÂå∫Âàá„Çä„Å´Â§âÊèõ
                const excavationElement = document.createElement('div');
                excavationElement.className = 'excavation-planet-item flex flex-col justify-between items-start';

                const lastExcavated = gameState.planetExcavationCooldowns[key] || 0;
                const planetCooldown = planet.excavationCooldown; // ÊÉëÊòüÂõ∫Êúâ„ÅÆ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„ÇíÂèñÂæó
                const timeElapsed = Date.now() - lastExcavated;
                const remainingTime = planetCooldown - timeElapsed;
                const isReady = remainingTime <= 0;
                const canExcavate = planet.level >= EXCAVATION_MIN_PLANET_LEVEL && isReady;

                excavationElement.innerHTML = `
                    <div class="flex items-center w-full">
                        <span class="text-3xl mr-3">${planet.icon}</span>
                        <h3 class="text-xl font-semibold flex-grow">${planetName} (Lv ${planet.level})</h3>
                        <button data-planet="${key}" class="excavate-button px-4 py-2 rounded-lg font-semibold transition duration-200
                            ${canExcavate ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-500 cursor-not-allowed'}"
                            ${!canExcavate ? 'disabled' : ''}>
                            ${planet.level < EXCAVATION_MIN_PLANET_LEVEL ? `„É¨„Éô„É´ ${planet.level}/${EXCAVATION_MIN_PLANET_LEVEL} ÂøÖË¶Å` : (isReady ? 'Êé°Êéò' : '„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥‰∏≠')}
                        </button>
                    </div>
                    <div class="w-full mt-2">
                        <div class="cooldown-bar-wrapper">
                            <div id="cooldown-bar-${key}" class="cooldown-bar" style="width: ${isReady ? 100 : (timeElapsed / planetCooldown) * 100}%;"></div>
                        </div>
                        <p id="cooldown-text-${key}" class="excavation-cooldown-display text-xs text-right mt-1">
                            ${isReady ? 'Ê∫ñÂÇôÂÆå‰∫Ü' : `ÊÆã„Çä: ${formatTime(remainingTime)}`}
                        </p>
                    </div>
                `;
                excavationPlanetList.appendChild(excavationElement);
            });

            // Êñ∞„Åó„ÅÑ„Éú„Çø„É≥„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„Çí„Ç¢„Çø„ÉÉ„ÉÅ
            excavationPlanetList.querySelectorAll('.excavate-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const planetKey = event.target.dataset.planet;
                    excavatePlanet(planetKey);
                });
            });
            updateExcavationPlanetButtons(); // „É™„Ç¢„É´„Çø„Ç§„É†„ÅÆ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥Ë°®Á§∫„ÅÆ„Åü„ÇÅ„Å´ÂàùÊúüÊõ¥Êñ∞
        }

        /**
         * ÊÉëÊòü„ÇíÊé°Êéò„Åó„Å¶„Ç¢„Ç§„ÉÜ„É†„ÇíÂèñÂæó„Åó„Åæ„Åô„ÄÇ
         * @param {string} planetKey - Êé°Êéò„Åô„ÇãÊÉëÊòü„ÅÆ„Ç≠„Éº„ÄÇ
         */
        function excavatePlanet(planetKey) {
            const planet = gameState.upgrades[planetKey];
            if (planet.level < EXCAVATION_MIN_PLANET_LEVEL) {
                showGenericModal(confirmationModal, `${planetKey}„ÇíÊé°Êéò„Åô„Çã„Å´„ÅØ„É¨„Éô„É´${EXCAVATION_MIN_PLANET_LEVEL}„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`, null, () => hideModal(confirmationModal), 'OK', 'bg-blue-600 hover:bg-blue-700', 'Èñâ„Åò„Çã');
                modalConfirmButton.style.display = 'none';
                return;
            }

            const lastExcavated = gameState.planetExcavationCooldowns[planetKey] || 0;
            const planetCooldown = planet.excavationCooldown; // ÊÉëÊòüÂõ∫Êúâ„ÅÆ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„ÇíÂèñÂæó
            const timeElapsed = Date.now() - lastExcavated;
            if (timeElapsed < planetCooldown) {
                const remainingTime = planetCooldown - timeElapsed;
                showGenericModal(confirmationModal, `${planetKey}„ÅØ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥‰∏≠„Åß„Åô„ÄÇÊÆã„Çä: ${formatTime(remainingTime)}`, null, () => hideModal(confirmationModal), 'OK', 'bg-blue-600 hover:bg-blue-700', 'Èñâ„Åò„Çã');
                modalConfirmButton.style.display = 'none';
                return;
            }

            // Êé°Êéò„É≠„Ç∏„ÉÉ„ÇØÔºöÊÉëÊòü„É¨„Éô„É´„Å´Âü∫„Å•„ÅÑ„Å¶„Ç¢„Ç§„ÉÜ„É†„Çí„É©„É≥„ÉÄ„É†„Å´ÂèñÂæó
            const itemsFound = {};
            let totalItems = 0;
            let message = `${planet.icon} ${planetKey.charAt(0).toUpperCase() + planetKey.slice(1).replace(/([A-Z])/g, ' $1').trim()}„ÇíÊé°Êéò„Åó„Åæ„Åó„ÅüÔºÅ`; // ÊÉëÊòüÂêç„ÇÇÊï¥ÂΩ¢

            // „É¨„Éô„É´„Å´Âøú„Åò„Å¶Áç≤Âæó„Ç¢„Ç§„ÉÜ„É†„ÅÆÊï∞„ÇíÂ¢ó„ÇÑ„Åô
            // baseItems„ÅØÊúÄ‰Ωé1„Å§„ÄÅ„Åù„ÅÆÂæå10„É¨„Éô„É´„Åî„Å®„Å´1„Å§ËøΩÂä†
            const baseItems = 1 + Math.floor(planet.level / 10);
            for (let i = 0; i < baseItems; i++) {
                const random = Math.random();
                let acquiredItem = '';
                if (random < 0.5) { // 50% ÈâÑÈâ±Áü≥
                    acquiredItem = 'ironOre';
                } else if (random < 0.8) { // 30% ÈäÖÈâ±Áü≥
                    acquiredItem = 'copperOre';
                } else if (random < 0.95) { // 15% ÈäÄÈâ±Áü≥
                    acquiredItem = 'silverOre';
                } else { // 5% ÈáëÈâ±Áü≥
                    acquiredItem = 'goldOre';
                }

                gameState.inventory[acquiredItem] = (gameState.inventory[acquiredItem] || 0) + 1;
                itemsFound[acquiredItem] = (itemsFound[acquiredItem] || 0) + 1;
                totalItems++;
            }

            if (totalItems > 0) {
                message += '<br>Áç≤Âæó„Ç¢„Ç§„ÉÜ„É†:';
                for (const itemKey in itemsFound) {
                    message += `<br>${itemData[itemKey].icon} ${itemData[itemKey].name}: ${itemsFound[itemKey]}`;
                }
            } else {
                message += '<br>‰Ωï„ÇÇË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ';
            }


            gameState.planetExcavationCooldowns[planetKey] = Date.now(); // „ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„ÇíË®≠ÂÆö
            updateDisplay(); // „É°„Ç§„É≥„ÅÆ„Éá„Ç£„Çπ„Éó„É¨„Ç§„Å®„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„Éê„Éº„ÇíÊõ¥Êñ∞
            renderExcavationPlanets(); // Êé°ÊéòÁîªÈù¢„ÅÆ„Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            renderInventory(); // „Ç§„É≥„Éô„É≥„Éà„É™„ÇíÊõ¥Êñ∞

            showGenericModal(confirmationModal, message, null, () => hideModal(confirmationModal), 'OK', 'bg-green-600 hover:bg-green-700', 'Èñâ„Åò„Çã');
            modalConfirmButton.style.display = 'none';
        }


        /**
         * „Ç≤„Éº„É†„ÇíÂàùÊúüÁä∂ÊÖã„Å´„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÄÇ
         * @param {boolean} strongStart - true„ÅÆÂ†¥Âêà„ÄÅÂº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„Éú„Éº„Éä„Çπ„ÇíÈÅ©Áî®„Åó„Åæ„Åô„ÄÇ
         */
        async function resetGame(strongStart = false) {
            // strongStart„Ååtrue„ÅÆÂ†¥Âêà„ÄÅ„ÇØ„É™„Ç¢„Åô„ÇãÂâç„Å´ÁèæÂú®„ÅÆstrongStartLevel„Çí‰øùÂ≠ò
            const prevStrongStartLevel = gameState.strongStartLevel;

            await clearGameData(); // „Åæ„ÅöIndexedDB„Çí„ÇØ„É™„Ç¢

            // „Ç≤„Éº„É†Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„ÄÅÂº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„ÅÆÂ†¥Âêà„ÅØstrongStartLevel„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà
            let newStrongStartLevel = strongStart ? prevStrongStartLevel + 1 : 0;

            // ÂàùÊúü„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çí„Éá„Ç£„Éº„Éó„Ç≥„Éî„Éº„Åó„Å¶„ÄÅ„Ç≥„Çπ„Éà„ÇíÁâπ„Å´„ÇØ„É™„Éº„É≥„Å™„É™„Çª„ÉÉ„Éà„Çí‰øùË®º„Åô„Çã
            // „Åì„Åì„ÅßnewPlanetsData„ÇÇËÄÉÊÖÆ„Å´ÂÖ•„Çå„Å¶„ÄÅÂàùÊúüÁä∂ÊÖã„Å´„ÅØÂê´„ÇÅ„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
            let initialUpgrades = JSON.parse(JSON.stringify({
                mercury: { level: 0, cost: 10, clickBonus: 1, autoBonus: 0, icon: '‚òø', excavationCooldown: 10 * 1000 },
                venus: { level: 0, cost: 50, clickBonus: 3, autoBonus: 0, icon: '‚ôÄ', excavationCooldown: 15 * 1000 },
                earth: { level: 0, cost: 200, clickBonus: 0, autoBonus: 5, icon: 'üåé', excavationCooldown: 20 * 1000 },
                mars: { level: 0, cost: 1000, clickBonus: 10, autoBonus: 0, icon: '‚ôÇ', excavationCooldown: 30 * 1000 },
                jupiter: { level: 0, cost: 5000, clickBonus: 0, autoBonus: 50, icon: '‚ôÉ', excavationCooldown: 45 * 1000 },
                saturn: { level: 0, cost: 25000, clickBonus: 0, autoBonus: 200, icon: '‚ôÑ', excavationCooldown: 60 * 1000 },
                uranus: { level: 0, cost: 100000, clickBonus: 50, autoBonus: 0, icon: '‚õ¢', excavationCooldown: 90 * 1000 },
                neptune: { level: 0, cost: 500000, clickBonus: 0, autoBonus: 1000, icon: '‚ôÜ', excavationCooldown: 120 * 1000 },
                originalPlanetX: { level: 0, cost: 2000000, clickBonus: 500, autoBonus: 5000, icon: 'ü™ê', excavationCooldown: 180 * 1000 },
                cosmicDrill: { level: 0, initialCost: 1e7, cost: 1e7, clickBonus: 10000, autoBonus: 0, icon: '‚õèÔ∏è', maxLevel: 1 },
                galacticReactor: { level: 0, initialCost: 5e7, cost: 5e7, clickBonus: 0, autoBonus: 10000, icon: '‚öõÔ∏è', maxLevel: 1 },
                heatClicker: { level: 0, initialCost: 1e6, cost: 1e6, clickBonus: 0, autoBonus: 0, icon: 'üî•', maxLevel: 1, currentMaxMultiplier: 2.0 },
                excavationLicense: { level: 0, initialCost: 1e5, cost: 1e5, clickBonus: 0, autoBonus: 0, icon: 'üìú', maxLevel: 1 },
                wideRangeTransfer: { level: 0, initialCost: 1e8, cost: 1e8, clickBonus: 0, autoBonus: 0, icon: 'üì°', maxLevel: 1, unlockedPlanets: [], breakthroughLevel: 0 },
                heatClickerBreakthrough: { level: 0, initialCost: 1e6, cost: 1e6, itemCost: { ironOre: 100, silverOre: 10 }, targetUpgrade: 'heatClicker', maxLevel: 5, icon: 'üí•', effect: 0.2, type: 'breakthrough' },
                wideRangeTransferBreakthrough: { level: 0, initialCost: 5e6, cost: 5e6, itemCost: { goldOre: 5, copperOre: 500 }, targetUpgrade: 'wideRangeTransfer', maxLevel: 3, icon: '‚ö°', unlocks: [ 'cometA', 'dwarfPlanet', 'gasGiantMoon' ], type: 'breakthrough' }
            }));

            // Êñ∞„Åó„ÅÑÊÉëÊòü„ÅØÂàùÊúüÁä∂ÊÖã„Åß„ÅØÂê´„ÇÅ„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
            // initialUpgrades„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Åã„ÇânewPlanetsData„ÅÆ„Ç≠„Éº„ÇíÂâäÈô§
            for (const key in newPlanetsData) {
                delete initialUpgrades[key];
            }


            gameState = {
                energy: 0,
                clickPower: 1,
                autoClickPower: 0,
                strongStartLevel: newStrongStartLevel,
                lastPlayedTime: Date.now(), // Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÅßlastPlayedTime„Çí„É™„Çª„ÉÉ„Éà
                heatClickMultiplier: 1.0, // Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„Åß„É™„Çª„ÉÉ„Éà
                lastClickTime: Date.now(), // Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„Åß„É™„Çª„ÉÉ„Éà
                selectedBatchAmount: 1, // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Éê„ÉÉ„ÉÅË≥ºÂÖ•Èáè„Å´„É™„Çª„ÉÉ„Éà
                upgrades: initialUpgrades,
                volume: 0.5, // Èü≥Èáè„Çí„Éá„Éï„Ç©„É´„Éà„Å´„É™„Çª„ÉÉ„Éà
                inventory: {}, // „Ç§„É≥„Éô„É≥„Éà„É™„Çí„É™„Çª„ÉÉ„Éà
                planetExcavationCooldowns: {} // „ÇØ„Éº„É´„ÉÄ„Ç¶„É≥„Çí„É™„Çª„ÉÉ„Éà
            };

            // ÁÜ±„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆÊúÄÂ§ßÂÄçÁéá„Çí„É™„Çª„ÉÉ„Éà
            MAX_HEAT_CLICK_MULTIPLIER = 2.0;

            if (strongStart) {
                // „Éú„Éº„Éä„Çπ„ÅØstrongStartLevel„Åß„Çπ„Ç±„Éº„É´
                // „É¨„Éô„É´0ÔºàÊúÄÂàù„ÅÆÂº∑Âäõ„Å™„Çπ„Çø„Éº„ÉàÔºâ„ÅØÂÄçÁéá1.0„ÇíÊÑèÂë≥
                // „É¨„Éô„É´1„ÅØÂÄçÁéá1.1„Å™„Å©„ÇíÊÑèÂë≥
                const bonusMultiplier = 1 + (newStrongStartLevel * 0.1);

                gameState.energy = 1000 * bonusMultiplier;
                gameState.clickPower = 10 * bonusMultiplier;
                gameState.autoClickPower = 1 * bonusMultiplier;

                // Âº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„É¨„Éô„É´„Å´Âøú„Åò„Å¶„ÄÅÈÄöÂ∏∏„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Å´ÂàùÊúü„É¨„Éô„É´„ÇíÈÅ©Áî®
                for (const key in gameState.upgrades) {
                    if (gameState.upgrades[key].maxLevel !== 1 && gameState.upgrades[key].excavationCooldown) { // excavationCooldown„ÅØÊÉëÊòü„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆ„Éû„Éº„Ç´„Éº„Å®„Åó„Å¶‰ΩøÁî®
                        const initialLevel = key === 'mercury' ? 5 : (key === 'venus' ? 2 : 0); // ÁâπÂÆö„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅÆÂü∫Êú¨„É¨„Éô„É´
                        const calculatedLevel = Math.floor(initialLevel * bonusMultiplier);

                        if (calculatedLevel > 0) { // „É¨„Éô„É´„ÅåÊ≠£„ÅÆÂ†¥Âêà„Å´„ÅÆ„ÅøÈÅ©Áî®
                            gameState.upgrades[key].level = calculatedLevel;
                            // Êñ∞„Åó„ÅÑ„É¨„Éô„É´„Å´Âü∫„Å•„ÅÑ„Å¶„Ç≥„Çπ„Éà„ÅåÂÜçË®àÁÆó„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
                            // initialCost„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÄÅ„Åù„Çå„ÇíË®àÁÆó„ÅÆÂü∫Ê∫ñ„Å®„Åó„Å¶‰ΩøÁî®„Åó„ÄÅ„Åù„ÅÜ„Åß„Å™„ÅÑÂ†¥Âêà„ÅØÁèæÂú®„ÅÆ„Ç≥„Çπ„Éà„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ
                            // „Åì„Çå„Å´„Çà„Çä„ÄÅ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåÊúÄÂàù„Å´0„Åß„ÅÇ„Å£„ÅüÂ†¥Âêà„Å´„ÄÅÊ¨°„ÅÆ„É¨„Éô„É´„ÅÆ„Ç≥„Çπ„Éà„ÅåÊ≠£„Åó„Åè„É™„Çª„ÉÉ„Éà„Åï„Çå„Åæ„Åô„ÄÇ
                            gameState.upgrades[key].cost = Math.floor((gameState.upgrades[key].initialCost || gameState.upgrades[key].cost) * Math.pow(1.5, calculatedLevel));
                            gameState.clickPower += gameState.upgrades[key].clickBonus * calculatedLevel;
                            gameState.autoClickPower += gameState.upgrades[key].autoBonus * calculatedLevel;
                        }
                    }
                }
            }
            // „É™„Çª„ÉÉ„ÉàÂæå„Å´„Ç™„Éº„Éá„Ç£„Ç™Ë®≠ÂÆö„ÇíÊõ¥Êñ∞
            audioElement.volume = gameState.volume;
            volumeSlider.value = gameState.volume * 100;
            updateSpeakerIcon(audioElement.volume, audioElement.muted);

            updateDisplay();
            renderUpgrades(); // „É™„Çª„ÉÉ„ÉàÂæå„Å´„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÇíÂÜç„É¨„É≥„ÉÄ„É™„É≥„Ç∞
            hideModal(confirmationModal);
            hideModal(settingsModal); // Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(upgradesSidebarModal); // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çµ„Ç§„Éâ„Éê„Éº„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(releaseNotesModal); // „É™„É™„Éº„Çπ„Éé„Éº„Éà„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(creditsModal); // „ÇØ„É¨„Ç∏„ÉÉ„Éà„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(inventoryModal); // „Ç§„É≥„Éô„É≥„Éà„É™„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(excavationModal); // Êé°Êéò„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            // „É™„Çª„ÉÉ„ÉàÂæå„Å´„Ç≤„Éº„É†„Çª„ÇØ„Ç∑„Éß„É≥„Å´Êàª„Çã
            showSection('game');
            // checkBreakthroughMenuVisibility(); // No longer needed
        }

        /**
         * ÈôêÁïåÁ™ÅÁ†¥„É°„Éã„É•„ÉºÈ†ÖÁõÆ„ÅÆË°®Á§∫/ÈùûË°®Á§∫„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åô„ÄÇ
         * „ÅÑ„Åö„Çå„Åã„ÅÆÈôêÁïåÁ™ÅÁ†¥„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåË≥ºÂÖ•Ê∏à„Åø„ÄÅ„Åæ„Åü„ÅØË≥ºÂÖ•ÂèØËÉΩÔºà„Ç®„Éç„É´„ÇÆ„Éº„Å®„Ç¢„Ç§„ÉÜ„É†„ÅåË∂≥„Çä„Å¶„ÅÑ„ÇãÔºâ„Åß„ÅÇ„Çå„Å∞Ë°®Á§∫„Åó„Åæ„Åô„ÄÇ
         * NOTE: This function is largely vestigial now as breakthrough upgrades are integrated into their target upgrades.
         * However, the data structure still supports it, and if a future UI needs a global breakthrough list, it could be used.
         */
        function checkBreakthroughMenuVisibility() {
            let shouldShow = false;
            for (const key in gameState.upgrades) {
                const upgrade = gameState.upgrades[key];
                if (upgrade.type === 'breakthrough') {
                    if (upgrade.level > 0) { // Êó¢„Å´Ë≥ºÂÖ•Ê∏à„Åø
                        shouldShow = true;
                        break;
                    }
                    // Ë≥ºÂÖ•ÂèØËÉΩ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                    const { totalEnergyCost, totalItemCost, levelsBought } = calculateBatchCostAndEffects(key, 1); // 1„É¨„Éô„É´Ë≥ºÂÖ•„Åß„ÉÅ„Çß„ÉÉ„ÇØ
                    if (levelsBought > 0 && totalEnergyCost <= gameState.energy) {
                        let canAffordItems = true;
                        if (upgrade.itemCost) {
                            for (const itemKey in upgrade.itemCost) {
                                if ((gameState.inventory[itemKey] || 0) < upgrade.itemCost[itemKey]) {
                                    canAffordItems = false;
                                    break;
                                }
                            }
                        }
                        if (canAffordItems) {
                            shouldShow = true;
                            break;
                        }
                    }
                }
            }

            // The breakthrough menu link is now always hidden in HTML,
            // so this function effectively does nothing in the current UI.
            // if (shouldShow) {
            //     breakthroughMenuLink.style.display = 'block';
            // } else {
            //     breakthroughMenuLink.style.display = 'none';
            // }
        }

        // --- UIÈñ¢Êï∞ ---

        /**
         * ÁâπÂÆö„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫„Åó„ÄÅ‰ªñ„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åô„ÄÇ
         * @param {string} sectionId - Ë°®Á§∫„Åô„Çã„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆID„ÄÇ
         */
        function showSection(sectionId) {
            sections.forEach(section => {
                if (section.id === sectionId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            sidebar.classList.remove('open'); // ÈÅ∏ÊäûÂæå„Å´Â∑¶„Çµ„Ç§„Éâ„Éê„Éº„ÇíÈñâ„Åò„Çã
            hideModal(upgradesSidebarModal); // „É°„Ç§„É≥„Çª„ÇØ„Ç∑„Éß„É≥„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çµ„Ç§„Éâ„Éê„Éº„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(settingsModal); // Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(releaseNotesModal); // „É™„É™„Éº„Çπ„Éé„Éº„Éà„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(creditsModal); // „ÇØ„É¨„Ç∏„ÉÉ„Éà„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(inventoryModal); // „Ç§„É≥„Éô„É≥„Éà„É™„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(excavationModal); // Êé°Êéò„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
        }

        /**
         * „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åó„ÄÅ„Åù„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å®„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÇíË®≠ÂÆö„Åó„Åæ„Åô„ÄÇ
         * @param {HTMLElement} modalElement - „É¢„Éº„ÉÄ„É´DOMË¶ÅÁ¥†„ÄÇ
         * @param {string} message - Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÄÇ
         * @param {function} confirmCallback - Á¢∫Ë™ç„Éú„Çø„É≥„ÅÆ„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÄÇ
         * @param {function} cancelCallback - „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥„ÅÆ„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÄÇ
         * @param {string} confirmButtonText - Á¢∫Ë™ç„Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÄÇ
         * @param {string} confirmButtonClass - Á¢∫Ë™ç„Éú„Çø„É≥„ÅÆËÉåÊôØ„ÅÆTailwind„ÇØ„É©„Çπ„ÄÇ
         * @param {string} cancelButtonText - „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÄÇ
         */
        function showGenericModal(modalElement, message, confirmCallback, cancelCallback, confirmButtonText = '„ÅØ„ÅÑ', confirmButtonClass = 'bg-red-600 hover:bg-red-700', cancelButtonText = '„Ç≠„É£„É≥„Çª„É´') {
            if (modalElement === confirmationModal) {
                modalMessage.innerHTML = message;
                modalConfirmButton.textContent = confirmButtonText;
                modalConfirmButton.className = 'modal-button confirm ' + confirmButtonClass;
                modalCancelButton.textContent = cancelButtonText;

                // Show/hide buttons based on callbacks
                if (confirmCallback) {
                    modalConfirmButton.style.display = 'inline-block';
                    modalConfirmButton.disabled = false; // Ensure it's not disabled
                } else {
                    modalConfirmButton.style.display = 'none';
                }

                if (cancelCallback) {
                    modalCancelButton.style.display = 'inline-block';
                } else {
                    modalCancelButton.style.display = 'none';
                }
            }

            currentConfirmCallback = confirmCallback;
            currentCancelCallback = cancelCallback;

            modalElement.classList.add('open');
        }

        /**
         * „É¢„Éº„ÉÄ„É´„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åô„ÄÇ
         * @param {HTMLElement} modalElement - ÈùûË°®Á§∫„Å´„Åô„Çã„É¢„Éº„ÉÄ„É´DOMË¶ÅÁ¥†„ÄÇ
         */
        function hideModal(modalElement) {
            modalElement.classList.remove('open');
            currentConfirmCallback = null;
            currentCancelCallback = null;

            // Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÈùûË°®Á§∫ÊôÇ„Å´„Éá„Éï„Ç©„É´„Éà„Å´„É™„Çª„ÉÉ„Éà
            if (modalElement === confirmationModal) {
                modalConfirmButton.style.display = 'inline-block';
                modalConfirmButton.disabled = false;
                modalCancelButton.textContent = '„Ç≠„É£„É≥„Çª„É´';
                // Â∞ÜÊù•„ÅÆÁî®ÈÄî„ÅÆ„Åü„ÇÅ„Å´„Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å®„ÇØ„É©„Çπ„Çí„Éá„Éï„Ç©„É´„Éà„Å´„É™„Çª„ÉÉ„Éà (‰æã: „Éá„Éº„ÇøÂâäÈô§)
                modalConfirmButton.textContent = '„ÅØ„ÅÑ„ÄÅÂâäÈô§„Åó„Åæ„Åô'; // ÂâäÈô§„ÅÆ„Éá„Éï„Ç©„É´„Éà
                modalConfirmButton.classList.remove('bg-yellow-600', 'hover:bg-yellow-700', 'bg-green-600', 'hover:bg-green-700', 'bg-blue-600', 'hover:bg-blue-700', 'bg-red-800', 'hover:bg-red-900');
                modalConfirmButton.classList.add('bg-red-600', 'hover:bg-red-700');
            }
        }

        /**
         * „É™„É™„Éº„Çπ„Éé„Éº„Éà„Çí„É™„É™„Éº„Çπ„Éé„Éº„Éà„É¢„Éº„ÉÄ„É´„Å´„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åó„Åæ„Åô„ÄÇ
         */
        function renderReleaseNotes() {
            releaseNotesContent.innerHTML = ''; // ‰ª•Ââç„ÅÆ„Éé„Éº„Éà„Çí„ÇØ„É™„Ç¢
            releaseNotesData.forEach(release => {
                const releaseItem = document.createElement('div');
                releaseItem.className = 'release-notes-item';
                releaseItem.innerHTML = `
                    <h4>${release.version} (${release.date})</h4>
                    <p>${release.notes}</p>
                `;
                releaseNotesContent.appendChild(releaseItem);
            });
        }

        /**
         * „ÇØ„É¨„Ç∏„ÉÉ„Éà„Çí„ÇØ„É¨„Ç∏„ÉÉ„Éà„É¢„Éº„ÉÄ„É´„Å´„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åó„Åæ„Åô„ÄÇ
         */
        function renderCredits() {
            creditsContent.innerHTML = `
                <div class="credits-item">
                    <h4>‰ΩúËÄÖ</h4>
                    <p>Minntelia</p>
                </div>
                <div class="credits-item">
                    <h4>Èü≥Ê•Ω</h4>
                    <p>‚ÄúEdgeworth Kuiperveld‚Äù by Akira Hata</p>
                </div>
            `;
        }

        /**
         * Â§öÊÆµÈöé„ÅÆÂâäÈô§Á¢∫Ë™ç„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂá¶ÁêÜ„Åó„Åæ„Åô„ÄÇ
         */
        function confirmDeleteData() {
            // Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åô„ÇãÂâç„Å´Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
            hideModal(settingsModal);

            if (confirmationStep === 0) {
                showGenericModal(confirmationModal, "Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆ„Ç≤„Éº„É†„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„Çå„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ", confirmDeleteData, () => { confirmationStep = 0; hideModal(confirmationModal); settingsModal.classList.add('open'); }, '„ÅØ„ÅÑ„ÄÅÂâäÈô§„Åó„Åæ„Åô', 'bg-red-600 hover:bg-red-700');
                confirmationStep++;
            } else if (confirmationStep === 1) {
                showGenericModal(confirmationModal, "ÊúÄÁµÇÁ¢∫Ë™ç: Êú¨ÂΩì„Å´Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆ„Ç≤„Éº„É†„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü", confirmDeleteData, () => { confirmationStep = 0; hideModal(confirmationModal); settingsModal.classList.add('open'); }, 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„ÅôÔºÅ', 'bg-yellow-600 hover:bg-yellow-700'); // ËøΩÂä†Ë≠¶Âëä„ÅÆ„Åü„ÇÅ„Å´Ëâ≤„ÇíÂ§âÊõ¥
                confirmationStep++;
            } else if (confirmationStep === 2) {
                showGenericModal(confirmationModal, "ÊúÄÂæå„ÅÆÁ¢∫Ë™ç: „Ç≤„Éº„É†„Éá„Éº„Çø„ÅØ„Åô„Åπ„Å¶Â§±„Çè„Çå„Åæ„Åô„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü", confirmDeleteData, () => { confirmationStep = 0; hideModal(confirmationModal); settingsModal.classList.add('open'); }, 'Á¢∫Ë™ç„Åó„Å¶ÂâäÈô§ÔºÅ', 'bg-red-800 hover:bg-red-900'); // „Åï„Çâ„Å´Âº∑„ÅÑË≠¶ÂëäËâ≤
                confirmationStep++;
            } else if (confirmationStep === 3) {
                resetGame(false); // ÂÆåÂÖ®„Å™„É™„Çª„ÉÉ„Éà„ÇíÂÆüË°åÔºàÂº∑Âäõ„Å™„Çπ„Çø„Éº„Éà„Åß„ÅØ„Å™„ÅÑÔºâ
                confirmationStep = 0; // Ê¨°Âõû„ÅÆ„Åü„ÇÅ„Å´„É™„Çª„ÉÉ„Éà
                hideModal(confirmationModal);
                hideModal(settingsModal); // ÂÆåÂÖ®„Å™„É™„Çª„ÉÉ„ÉàÂæå„Å´Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇÇÈùûË°®Á§∫„Å´„Åô„Çã
            }
        }

        /**
         * „É™„Éì„ÉÉ„Ç∞„Éê„É≥Á¢∫Ë™ç„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂá¶ÁêÜ„Åó„Åæ„Åô„ÄÇ
         */
        function confirmRebigBang() {
            const requiredEnergy = getStrongStartCurrentCost();
            if (gameState.energy < requiredEnergy) {
                showGenericModal(confirmationModal, `„É™„Éì„ÉÉ„Ç∞„Éê„É≥„Å´„ÅØ ${formatNumber(requiredEnergy)} „Ç®„Éç„É´„ÇÆ„Éº„ÅåÂøÖË¶Å„Åß„Åô„ÄÇÁèæÂú®„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„ÅØ ${formatNumber(gameState.energy)} „Åß„Åô„ÄÇ`, null, () => hideModal(confirmationModal), 'OK', 'bg-blue-600 hover:bg-blue-700', 'Èñâ„Åò„Çã');
                modalConfirmButton.style.display = 'none'; // OK„Éú„Çø„É≥„ÇíÈùûË°®Á§∫„Å´„Åó„ÄÅ„É¶„Éº„Ç∂„Éº„ÅØ„ÄåÈñâ„Åò„Çã„Äç„ÅÆ„Åø„ÇØ„É™„ÉÉ„ÇØ
                return;
            }

            showGenericModal(confirmationModal, `„É™„Éì„ÉÉ„Ç∞„Éê„É≥„ÇíÈñãÂßã„Åó„Åæ„Åô„ÄÇÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ„Åô„Åπ„Å¶ÂâäÈô§„Åï„Çå„ÄÅ„É¨„Éô„É´ ${gameState.strongStartLevel + 1} „ÅÆ„Éú„Éº„Éä„Çπ‰ªò„Åç„ÅßÈñãÂßã„Åï„Çå„Åæ„Åô„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü`,
                () => { // Á¢∫Ë™ç„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
                    resetGame(true);
                    hideModal(confirmationModal);
                },
                () => { // „Ç≠„É£„É≥„Çª„É´„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
                    hideModal(confirmationModal);
                },
                'ÈñãÂßãÔºÅ',
                'bg-green-600 hover:bg-green-700'
            );
        }

        // --- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº ---

        // Êòü„ÅÆ„ÇØ„É™„ÉÉ„Ç´„Éº
        starClicker.addEventListener('click', clickStar);

        // „É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆ„Éà„Ç∞„É´
        menuButton.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„É™„É≥„ÇØ („É¢„Éº„ÉÄ„É´/„Çª„ÇØ„Ç∑„Éß„É≥Áî®)
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const sectionId = event.target.dataset.section;
                const modalId = event.target.dataset.modal;
                const action = event.target.dataset.action;
                const scrollToTarget = event.target.dataset.scrollTo; // Êñ∞„Åó„ÅÑÂ±ûÊÄß

                if (sectionId) {
                    showSection(sectionId);
                } else if (modalId === 'settings-modal') {
                    settingsModal.classList.add('open');
                } else if (modalId === 'upgrades-sidebar-modal') {
                    upgradesSidebarModal.classList.add('open');
                    // „Çπ„ÇØ„É≠„Éº„É´„ÇíË©¶„Åø„ÇãÂâç„Å´„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Åå„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
                    renderUpgrades();
                    // „Éê„ÉÉ„ÉÅË≥ºÂÖ•„Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
                    updateBatchCycleButton();
                    if (scrollToTarget) {
                        // „É¢„Éº„ÉÄ„É´„ÅåÈñã„ÅÑ„Å¶„Åã„Çâ„Çπ„ÇØ„É≠„Éº„É´„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã
                        setTimeout(() => {
                            const targetElement = document.getElementById(scrollToTarget);
                            if (targetElement) {
                                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        }, 300); // „É¢„Éº„ÉÄ„É´„ÅÆ„Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥ÊôÇÈñì„Å´Âêà„Çè„Åõ„Çã
                    }
                } else if (modalId === 'inventory-modal') {
                    inventoryModal.classList.add('open');
                    renderInventory(); // „Ç§„É≥„Éô„É≥„Éà„É™„ÇíË°®Á§∫
                } else if (modalId === 'excavation-modal') {
                    // Êé°Êéò„É©„Ç§„Çª„É≥„Çπ„ÅåË≥ºÂÖ•Ê∏à„Åø„ÅÆÂ†¥Âêà„ÅÆ„ÅøÈñã„Åè
                    if (gameState.upgrades.excavationLicense && gameState.upgrades.excavationLicense.level > 0) {
                        excavationModal.classList.add('open');
                        renderExcavationPlanets(); // Êé°ÊéòÊÉëÊòü„ÇíË°®Á§∫
                    } else {
                        showGenericModal(confirmationModal, "ÊÉëÊòüÊé°ÊéòÊ©üËÉΩ„Çí‰ΩøÁî®„Åô„Çã„Å´„ÅØ„ÄåÊé°Êéò„É©„Ç§„Çª„É≥„Çπ„Äç„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ", null, () => hideModal(confirmationModal), 'OK', 'bg-blue-600 hover:bg-blue-700', 'Èñâ„Åò„Çã');
                        modalConfirmButton.style.display = 'none';
                    }
                }
                else if (action === 'rebig-bang') {
                    confirmRebigBang();
                }
                sidebar.classList.remove('open'); // ÈÅ∏ÊäûÂæå„Å´„Çµ„Ç§„Éâ„Éê„Éº„ÇíÈñâ„Åò„Çã
            });
        });

        // „Éê„ÉÉ„ÉÅË≥ºÂÖ•„Çµ„Ç§„ÇØ„É™„É≥„Ç∞„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        batchCycleButton.addEventListener('click', () => {
            let currentIndex = batchAmounts.indexOf(gameState.selectedBatchAmount);
            let nextIndex = (currentIndex + 1) % batchAmounts.length;
            gameState.selectedBatchAmount = batchAmounts[nextIndex];
            updateBatchCycleButton();
            renderUpgrades(); // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„É™„Çπ„Éà„ÇíÂÜç„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åó„Å¶„ÄÅË≥ºÂÖ•„Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
        });

        /**
         * „Éê„ÉÉ„ÉÅË≥ºÂÖ•„Çµ„Ç§„ÇØ„É´„Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô„ÄÇ
         */
        function updateBatchCycleButton() {
            if (gameState.selectedBatchAmount === 'max') {
                batchCycleButton.textContent = 'Ë≥ºÂÖ•Èáè: Max';
            } else {
                batchCycleButton.textContent = `Ë≥ºÂÖ•Èáè: x${gameState.selectedBatchAmount}`;
            }
        }


        // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çµ„Ç§„Éâ„Éê„Éº„ÇíÈñâ„Åò„Çã
        closeUpgradesSidebarButton.addEventListener('click', () => {
            hideModal(upgradesSidebarModal);
        });

        // „Ç§„É≥„Éô„É≥„Éà„É™„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        closeInventoryModal.addEventListener('click', () => {
            hideModal(inventoryModal);
        });

        // Êé°Êéò„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        closeExcavationModal.addEventListener('click', () => {
            hideModal(excavationModal);
        });

        // Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÅÆ„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥
        releaseNotesButton.addEventListener('click', () => {
            hideModal(settingsModal); // „É™„É™„Éº„Çπ„Éé„Éº„Éà„ÇíÈñã„Åè„Å®„Åç„Å´Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
            releaseNotesModal.classList.add('open');
            renderReleaseNotes(); // „É™„É™„Éº„Çπ„Éé„Éº„Éà„ÇíË°®Á§∫
        });

        creditsButton.addEventListener('click', () => {
            hideModal(settingsModal); // „ÇØ„É¨„Ç∏„ÉÉ„Éà„ÇíÈñã„Åè„Å®„Åç„Å´Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
            creditsModal.classList.add('open');
            renderCredits(); // „ÇØ„É¨„Ç∏„ÉÉ„Éà„ÇíË°®Á§∫
        });

        closeReleaseNotesModalButton.addEventListener('click', () => {
            hideModal(releaseNotesModal);
        });

        closeCreditsModalButton.addEventListener('click', () => {
            hideModal(creditsModal);
        });

        deleteDataButton.addEventListener('click', () => {
            confirmationStep = 0; // ÂâäÈô§Á¢∫Ë™ç„Çπ„ÉÜ„ÉÉ„Éó„Çí„É™„Çª„ÉÉ„Éà
            confirmDeleteData();
        });

        closeSettingsModalButton.addEventListener('click', () => {
            hideModal(settingsModal);
        });

        // Ê±éÁî®„É¢„Éº„ÉÄ„É´„ÇØ„É≠„Éº„Ç∫„Éú„Çø„É≥ (Á¢∫Ë™ç„ÄÅË®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÄÅÊñ∞„Åó„ÅÑ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çµ„Ç§„Éâ„Éê„Éº„ÄÅ„É™„É™„Éº„Çπ„Éé„Éº„Éà„É¢„Éº„ÉÄ„É´)
        modalCloseButtons.forEach(button => {
            button.addEventListener('click', () => {
                hideModal(button.closest('.modal') || button.closest('.upgrades-sidebar'));
            });
        });

        // Ê±éÁî®Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„Éú„Çø„É≥„É™„Çπ„Éä„Éº
        modalConfirmButton.addEventListener('click', () => {
            if (currentConfirmCallback) {
                currentConfirmCallback();
            }
            // „É¢„Éº„ÉÄ„É´Âõ∫Êúâ„ÅÆÁä∂ÊÖã„ÅÆ„É™„Çª„ÉÉ„Éà„ÅØhideModal„ÅßÂá¶ÁêÜ„Åï„Çå„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü
        });

        modalCancelButton.addEventListener('click', () => {
            if (currentCancelCallback) {
                currentCancelCallback();
            }
            // „É¢„Éº„ÉÄ„É´Âõ∫Êúâ„ÅÆÁä∂ÊÖã„ÅÆ„É™„Çª„ÉÉ„Éà„ÅØhideModal„ÅßÂá¶ÁêÜ„Åï„Çå„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü
        });

        // Èü≥Èáè„Ç≥„É≥„Éà„É≠„Éº„É´„É™„Çπ„Éä„Éº
        volumeSlider.addEventListener('input', () => {
            const volume = parseFloat(volumeSlider.value) / 100;
            audioElement.volume = volume;
            if (volume > 0) {
                audioElement.muted = false;
                lastVolumeBeforeMute = volume; // „Éü„É•„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅÊúÄÂæå„ÅÆÈü≥Èáè„ÇíÊõ¥Êñ∞
            }
            updateSpeakerIcon(audioElement.volume, audioElement.muted);
        });

        speakerIcon.addEventListener('click', () => {
            if (audioElement.muted) {
                audioElement.muted = false;
                // ‰ª•Ââç„ÅÆÈü≥Èáè„Åæ„Åü„ÅØ„Éá„Éï„Ç©„É´„ÉàÔºà‰ª•Ââç„ÅÆÈü≥Èáè„Åå„Å™„Åë„Çå„Å∞Ôºâ„ÇíÂæ©ÂÖÉ
                audioElement.volume = lastVolumeBeforeMute > 0 ? lastVolumeBeforeMute : 0.5;
                volumeSlider.value = audioElement.volume * 100;
                audioElement.play().catch(e => console.error("„Éü„É•„Éº„ÉàËß£Èô§ÊôÇ„ÅÆËá™ÂãïÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", e)); // „Éü„É•„Éº„Éà„Åï„Çå„Å¶„ÅÑ„ÅüÂ†¥Âêà„ÄÅÂÜçÁîü„ÇíË©¶„Åø„Çã
            } else {
                lastVolumeBeforeMute = audioElement.volume; // „Éü„É•„Éº„Éà„Åô„ÇãÂâç„Å´ÁèæÂú®„ÅÆÈü≥Èáè„Çí‰øùÂ≠ò
                audioElement.muted = true;
                volumeSlider.value = 0; // „Éü„É•„Éº„ÉàÊôÇ„Å´„Çπ„É©„Ç§„ÉÄ„Éº„Çí0„Å´ÁßªÂãï
            }
            updateSpeakerIcon(audioElement.volume, audioElement.muted);
        });

        // „ÇØ„Éº„É´„ÉÄ„Ç¶„É≥Êõ¥Êñ∞Áî®„ÅÆÂÆöÊúüÁöÑ„Å™„Ç§„É≥„Çø„Éº„Éê„É´
        setInterval(() => {
            updateExcavationCooldownDisplay(); // This now mainly updates visibility of the wrapper
            if (excavationModal.classList.contains('open')) {
                updateExcavationPlanetButtons(); // Only update planet buttons if excavation modal is open
            }
        }, 500); // 500ms„Åî„Å®„Å´Êõ¥Êñ∞

        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É≠„Éº„ÉâÊôÇ„Å´„Ç≤„Éº„É†„ÇíÂàùÊúüÂåñ
        window.onload = async () => {
            await initDb();
            await loadGame();
            renderUpgrades(); // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„É™„Çπ„Éà„ÅÆÂàùÊúü„É¨„É≥„ÉÄ„É™„É≥„Ç∞

            // „É≠„Éº„Éâ„Åï„Çå„Åü„Ç≤„Éº„É†Áä∂ÊÖã„Åã„Çâ„Ç™„Éº„Éá„Ç£„Ç™Ë®≠ÂÆö„ÇíÂàùÊúüÂåñ
            // Music defaults to 50%
            gameState.volume = 0.5; // Explicitly set default volume
            audioElement.volume = gameState.volume;
            volumeSlider.value = gameState.volume * 100;
            updateSpeakerIcon(audioElement.volume, audioElement.muted);
            // Èü≥Ê•Ω„ÅÆÂÜçÁîü„ÇíË©¶„Åø„Åæ„Åô„ÄÇ„É¶„Éº„Ç∂„Éº„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥„Åæ„Åß„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
            audioElement.play().catch(e => {
                console.warn("Ëá™ÂãïÂÜçÁîü„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„ÄÇÈü≥Ê•Ω„ÅØÊúÄÂàù„ÅÆ„É¶„Éº„Ç∂„Éº„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥Ôºà‰æãÔºöÊòü„ÅÆ„ÇØ„É™„ÉÉ„ÇØÔºâ„ÅßÈñãÂßã„Åï„Çå„Åæ„Åô„ÄÇ", e);
                // Ëá™ÂãïÂÜçÁîü„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÂ†¥Âêà„ÄÅÂàùÊúüÁä∂ÊÖã„Åå„Åì„Çå„ÇíÂèçÊò†„Åó„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
                audioElement.muted = true; // ÂÜçÁîü„Åß„Åç„Å™„Åã„Å£„ÅüÂ†¥Âêà„ÄÅ„Éü„É•„Éº„Éà„Å®„Åó„Å¶„Éû„Éº„ÇØ
                volumeSlider.value = 0;
                updateSpeakerIcon(0, true);
            });

            setInterval(autoClickLoop, 100); // 100ms„Åî„Å®„Å´Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ
            setInterval(checkHeatClickerReset, 500); // 500ms„Åî„Å®„Å´„Éí„Éº„Éà„ÇØ„É™„ÉÉ„Ç´„Éº„ÅÆ„É™„Çª„ÉÉ„Éà„ÇíÁ¢∫Ë™ç
            // ÂàùÊúü„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË®≠ÂÆö
            showSection('game'); // „É≠„Éº„ÉâÊôÇ„Å´„Ç≤„Éº„É†„Çª„ÇØ„Ç∑„Éß„É≥„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
        };
    </script>
</body>
</html>
